<%- include('./partials/header') %>

<div class="container mt-4">
  <h3 class="mb-4">üìã ‡πÑ‡∏ü‡∏•‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>

  <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î -->
  <div class="row mb-3 align-items-center">
    <div class="col-md-6">
      <form method="GET" action="/business">
        <div class="input-group">
          <input type="text" name="search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå" value="<%= search %>">
          <button class="btn btn-outline-secondary" type="submit">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
          <a href="/business" class="btn btn-outline-danger">‡∏•‡πâ‡∏≤‡∏á</a>
        </div>
      </form>
    </div>
    <div class="col-md-6 text-end">
      <% if(user && (user.mClass === 'kts' || user.mClass === 'admin')) { %>
        <a href="/business/upload" class="btn btn-success">
          <i class="bi bi-plus-circle"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
        </a>
      <% } %>
    </div>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå/‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</th>
        </tr>
      </thead>
      <tbody>
        <% if(fileGrouped && Object.keys(fileGrouped).length > 0) { %>
          <% Object.keys(fileGrouped).forEach(buName => { %>
            <tr>
              <td>
                <h5 class="mb-2"><%= buName %></h5>
                <% fileGrouped[buName].forEach(file => { %>
                  <div class="card mb-2 p-2 shadow-sm">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <strong>‡∏õ‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> <%= file.end_date  %> <%= file.bu_endyear %>
                      </div>
                      <div class="btn-group btn-group-sm">
                        <a href="/business/download/<%= file.bu_id %>" class="btn btn-outline-primary">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>
                        <% if(user && (user.mClass === 'admin' || user.mClass === 'kbs')) { %>
                          <a href="/business/delete/<%= file.bu_id %>" class="btn btn-outline-danger" onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?')">‡∏•‡∏ö</a>
                        <% } %>
                      </div>
                    </div>
                  </div>
                <% }) %>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if(totalPages > 1) { %>
    <nav class="mt-4">
      <ul class="pagination justify-content-center">
        <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
            <a class="page-link" href="/business?page=<%= i %><%= search ? '&search=' + encodeURIComponent(search) : '' %>">
              <%= i %>
            </a>
          </li>
        <% } %>
      </ul>
    </nav>
  <% } %>
</div>

<%- include('./partials/footer') %>

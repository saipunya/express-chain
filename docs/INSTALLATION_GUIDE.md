# ЁЯУЛ р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З: р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕гр╕▓р╕вр╣Ар╕Фр╕╖р╕нр╕Щ

## ЁЯУМ р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 1: р╕кр╕гр╣Йр╕▓р╕Зр╕Хр╕▓р╕гр╕▓р╕З Database

### р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Б A: р╣Гр╕Кр╣Й MySQL Client

```bash
mysql -u р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й -p р╕Кр╕╖р╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е < migrations/001_create_plan_budget_disbursal.sql
```

### р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Б B: р╕гр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕З SQL р╣Вр╕Фр╕вр╕Хр╕гр╕З

р╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╕Чр╕╡р╣И MySQL/MariaDB р╣Бр╕ер╣Йр╕зр╕гр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕З:

```sql
CREATE TABLE IF NOT EXISTS plan_budget_disbursal (
  id INT AUTO_INCREMENT PRIMARY KEY,
  pro_id INT NOT NULL,
  disbursal_date DATE NOT NULL,
  amount DECIMAL(12, 2) NOT NULL,
  description TEXT,
  disbursal_type VARCHAR(50),
  reference_no VARCHAR(100),
  created_by VARCHAR(100),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_by VARCHAR(100),
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (pro_id) REFERENCES plan_project(pro_id) ON DELETE CASCADE,
  INDEX idx_project_date (pro_id, disbursal_date),
  INDEX idx_year_month (disbursal_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='р╕Хр╕▓р╕гр╕▓р╕З р╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Бр╣Ар╕Зр╕┤р╕Щр╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Хр╕▓р╕бр╣Ар╕Фр╕╖р╕нр╕Щ';
```

### р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Б C: р╣Гр╕Кр╣Й Workbench р╕лр╕гр╕╖р╕н phpMyAdmin

1. р╣Ар╕Ыр╕┤р╕Ф Workbench/phpMyAdmin
2. р╣Ар╕ер╕╖р╕нр╕Бр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╕нр╕Зр╕Др╕╕р╕У
3. р╕Др╕ер╕┤р╕Б "New Query" р╕лр╕гр╕╖р╕н "SQL"
4. copy paste SQL р╕Вр╣Йр╕▓р╕Зр╕Ър╕Щ
5. р╕Др╕ер╕┤р╕Б "Execute"

---

## тЪЩя╕П р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 2: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Вр╣Йр╕▓

р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕бр╕╡р╣Др╕Яр╕ер╣Мр╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Йр╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з:

```
тЬУ models/planBudgetDisbursal.js
тЬУ controllers/planBudgetDisbursalController.js
тЬУ views/plan_project/budget_disbursal.ejs
тЬУ routes/planProjectRoutes.js (р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Бр╕ер╣Йр╕з)
тЬУ controllers/planProjectController.js (р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Бр╕ер╣Йр╕з)
тЬУ views/plan_project/summary.ejs (р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Бр╕ер╣Йр╕з)
```

---

## ЁЯЪА р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 3: р╕гр╕╡р╕кр╕Хр╕▓р╕гр╣Мр╕Ч Server

```bash
npm start
```

---

## ЁЯУЦ р╕зр╕┤р╕Шр╕╡р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╣Ар╕Вр╣Йр╕▓р╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ Summary (р╣Бр╕Щр╕░р╕Щр╕│)

1. р╣Др╕Ыр╕Чр╕╡р╣И **Plan Dashboard**
2. р╕Др╕ер╕┤р╕Бр╕Чр╕╡р╣Ир╣Вр╕Др╕гр╕Зр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г
3. р╣Гр╕Щр╕лр╕Щр╣Йр╕▓ Summary р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕б **"р╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Бр╣Ар╕Зр╕┤р╕Щ"** (р╕кр╕╡р╣Ар╕лр╕ер╕╖р╕нр╕З)

### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╣Ар╕Вр╣Йр╕▓р╣Вр╕Фр╕вр╕Хр╕гр╕З

```
/plan_project/budget_disbursal?pro_code=PRJ001
```

---

## ЁЯТ░ р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╕гр╕▓р╕вр╣Ар╕Фр╕╖р╕нр╕Щ

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ:

1. **р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕б "р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Б"** (р╕кр╕╡р╕Щр╣Йр╕│р╣Ар╕Зр╕┤р╕Щ)
2. **р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е** р╣Гр╕Щр╣Бр╕Ър╕Ър╕Яр╕нр╕гр╣Мр╕б:
   - **р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕Ър╕┤р╕Б** (date): р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕Ър╕┤р╕Бр╣Ар╕Зр╕┤р╕Щ
   - **р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ** (amount): р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Ър╕▓р╕Ч
   - **р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И** (type): р╣Ар╕ер╕╖р╕нр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Ч
   - **р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф** (description): р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Б
   - **р╣Ар╕ер╕Вр╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕З** (reference): р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И/PO (р╕Цр╣Йр╕▓р╕бр╕╡)
3. **р╕Др╕ер╕┤р╕Б "р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б"**

### р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Б:

- ЁЯОп **р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б** (Activity)
- ЁЯУж **р╕зр╕▒р╕кр╕Фр╕╕** (Material)
- ЁЯС╖ **р╕Др╣Ир╕▓р╣Бр╕гр╕З** (Labor)
- ЁЯФз **р╕нр╕╕р╕Ыр╕Бр╕гр╕Ур╣М** (Equipment)
- ЁЯУЭ **р╕нр╕╖р╣Ир╕Щр╣Ж** (Other)

---

## ЁЯУК р╣Бр╕кр╕Фр╕Зр╕Ьр╕е

### 1я╕ПтГг **р╕кр╕гр╕╕р╕Ы 4 р╕Кр╣Ир╕нр╕З:**
- р╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
- р╕гр╕зр╕бр╣Ар╕Ър╕┤р╕Бр╣Др╕Ыр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ
- р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н
- р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Б

### 2я╕ПтГг **Tab: р╕кр╕гр╕╕р╕Ыр╕гр╕▓р╕вр╣Ар╕Фр╕╖р╕нр╕Щ**
- р╣Бр╕кр╕Фр╕Зр╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Бр╣Бр╕Хр╣Ир╕ер╕░р╣Ар╕Фр╕╖р╕нр╕Щ
- р╣Бр╕кр╕Фр╕Зр╕вр╕нр╕Фр╕кр╕░р╕кр╕б
- р╣Бр╕кр╕Фр╕Зр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н
- р╣Бр╕Цр╕Ър╕Др╕зр╕▓р╕бр╕Бр╣Йр╕▓р╕зр╕лр╕Щр╣Йр╕▓ (%):
  - ЁЯЯв р╣Ар╕Вр╕╡р╕вр╕з: 0-80% (р╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в)
  - ЁЯЯб р╣Ар╕лр╕ер╕╖р╕нр╕З: 80-100% (р╣Ар╕Бр╕╖р╕нр╕Ър╕лр╕бр╕Ф)
  - ЁЯФ┤ р╣Бр╕Фр╕З: >100% (р╣Ар╕Бр╕┤р╕Щр╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕У)

### 3я╕ПтГг **Tab: р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф**
- р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Бр╣Бр╕Ър╕Ър╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
- р╕зр╕▒р╕Щр╕Чр╕╡р╣И р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ
- р╕Ыр╕╕р╣Ир╕бр╕ер╕Ъ

---

## ЁЯУе р╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е

### р╕кр╣Ир╕Зр╕нр╕нр╕Б CSV:

1. р╕Др╕ер╕┤р╕Б **"р╕кр╣Ир╕Зр╕нр╕нр╕Б CSV"**
2. р╣Др╕Яр╕ер╣Мр╕Ир╕░р╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
3. р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Щ Excel р╣Ар╕Юр╕╖р╣Ир╕нр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

---

## ЁЯОп р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З

### р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Бр╣Ар╕Зр╕┤р╕Щр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З:

| р╕зр╕▒р╕Щр╕Чр╕╡р╣И | р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И | р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф | р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ | р╣Ар╕Фр╕╖р╕нр╕Щ |
|-------|---------|-----------|----------|-------|
| 2025-02-01 | р╕зр╕▒р╕кр╕Фр╕╕ | р╕Ир╣Ир╕▓р╕вр╕кр╕нр╕Ър╕лр╕ер╕▒р╕Бр╕кр╕╣р╕Хр╕г | 5,000 | Feb 2025 |
| 2025-02-10 | р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б | р╕Др╣Ир╕▓р╕зр╕▒р╕кр╕Фр╕╕р╕Ыр╕гр╕░р╕Бр╕зр╕Ф | 3,500 | Feb 2025 |
| 2025-03-05 | р╕Др╣Ир╕▓р╣Бр╕гр╕З | р╕Др╣Ир╕▓р╕Ир╣Йр╕▓р╕Зр╕Юр╕┤р╣Ар╕ир╕й | 7,000 | Mar 2025 |

### р╕Ьр╕ер╕Бр╕▓р╕гр╕кр╕гр╕╕р╕Ы:

- **Feb 2025**: р╣Ар╕Ър╕┤р╕Б 8,500 тЖТ р╕кр╕░р╕кр╕б 8,500 тЖТ р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н (р╕Зр╕Ъ - 8,500)
- **Mar 2025**: р╣Ар╕Ър╕┤р╕Б 7,000 тЖТ р╕кр╕░р╕кр╕б 15,500 тЖТ р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н (р╕Зр╕Ъ - 15,500)

---

## тЪая╕П р╕Вр╣Йр╕нр╕кр╕│р╕Др╕▒р╕Н

- тЬЕ р╕вр╕нр╕Фр╕кр╕░р╕кр╕бр╕Др╕│р╕Щр╕зр╕Ур╕Ир╕▓р╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕Ър╕┤р╕Б (р╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ър╣Ар╕зр╕ер╕▓)
- тЬЕ р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н = р╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф - р╕вр╕нр╕Фр╕кр╕░р╕кр╕б
- тЬЕ р╕Цр╣Йр╕▓р╣Ар╕Ър╕┤р╕Бр╣Ар╕Бр╕┤р╕Щр╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Ир╕░р╣Бр╕кр╕Фр╕Зр╕кр╕╡р╣Бр╕Фр╕З
- тЬЕ р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕ер╕Ър╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Бр╣Др╕Фр╣Й р╣Бр╕Хр╣Ир╕Ир╕░р╕Др╕│р╕Щр╕зр╕Ур╣Гр╕лр╕бр╣Ир╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
- тЪая╕П р╕Хр╣Йр╕нр╕Зр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Бр╣Ир╕нр╕Щр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

---

## ЁЯФЧ API Reference

### GET `/plan_project/budget_disbursal`
р╕Фр╕╢р╕Зр╕лр╕Щр╣Йр╕▓р╕гр╕▓р╕вр╕Зр╕▓р╕Щ
```
Query: pro_code=PRJ001
```

### POST `/plan_project/budget_disbursal`
р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Б
```json
{
  "pro_code": "PRJ001",
  "disbursal_date": "2025-02-06",
  "amount": "5000",
  "description": "р╕Ир╣Ир╕▓р╕вр╕Др╣Ир╕▓р╕зр╕▒р╕кр╕Фр╕╕",
  "disbursal_type": "material",
  "reference_no": "INV-001"
}
```

### DELETE `/plan_project/budget_disbursal/:id`
р╕ер╕Ър╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Б
```
Query: pro_code=PRJ001
```

### GET `/plan_project/budget_disbursal/export`
р╕кр╣Ир╕Зр╕нр╕нр╕Б CSV
```
Query: pro_code=PRJ001
```

---

## ЁЯРЫ Troubleshooting

### тЭМ р╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕╕р╣Ир╕б "р╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Бр╣Ар╕Зр╕┤р╕Щ"
- р╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕гр╕╡р╕кр╕Хр╕▓р╕гр╣Мр╕Ч тЖТ р╕гр╕▒р╕Щ `npm start`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Ар╕кр╣Йр╕Щр╕Чр╕▓р╕З route р╣Гр╕Щ planProjectRoutes.js

### тЭМ р╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф "table plan_budget_disbursal does not exist"
- р╕Хр╕▓р╕гр╕▓р╕З Database р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕кр╕гр╣Йр╕▓р╕З тЖТ р╕гр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕З SQL р╕Фр╣Йр╕▓р╕Щр╕Ър╕Щ

### тЭМ р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╣Ар╕Ър╕┤р╕Б
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Server logs
- р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕зр╣Ир╕▓р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╣Бр╕ер╣Йр╕з
- р╕ер╕нр╕З refresh page

---

## ЁЯУЭ Note

- р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Щр╕╡р╣Йр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕нр╕нр╕Бр╣Бр╕Ър╕Ър╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╕гр╕▓р╕вр╣Ар╕Фр╕╖р╕нр╕Щр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ
- р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╣Др╕Фр╣Йр╣Гр╕Щр╣Др╕Яр╕ер╣М controller
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕░р╕Цр╕╣р╕Бр╕ер╕Ър╕нр╕нр╕Бр╕лр╕▓р╕Бр╕ер╕Ър╣Вр╕Др╕гр╕Зр╕Бр╕▓р╕г (CASCADE delete)

---

**тЬЕ р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡** ЁЯОЙ

<%- include('partials/header.ejs') %>

  <!-- Modern Dashboard -->
  <div class="container-fluid py-4 dashboard-wrapper">
    <div class="container">
      <!-- Welcome / Profile Section -->
      <div class="row g-4 align-items-stretch mb-4">
        <div class="col-lg-8">
          <div class="card border-0 shadow-lg glass-card h-100">
            <div class="card-body p-4 p-lg-5 d-flex flex-column justify-content-center">
              <h1 class="display-6 fw-bold text-gradient mb-3">
                <i class="bi bi-speedometer2 me-2"></i> แดชบอร์ด
              </h1>
              <p class="text-muted mb-4">ศูนย์รวมเมนูการทำงานและข้อมูลล่าสุด เพื่อการเข้าถึงฟีเจอร์อย่างรวดเร็ว</p>

              <!-- Quick Action Buttons (Role Based) -->
              <div class="d-flex flex-wrap gap-2">
                <% if (user && user.mClass === 'kjs') { %>
                  <a href="/account/list" class="btn btn-outline-primary btn-action"><i class="bi bi-wallet2 me-1"></i> บัญชี กจส</a>
                  <a href="/gitgum/list" class="btn btn-outline-success btn-action"><i class="bi bi-activity me-1"></i> เพิ่มกิจกรรม กจส</a>
                  <a href="/chamra/" class="btn btn-outline-danger btn-action"><i class="bi bi-info-circle me-1"></i> ชำระบัญชี</a>
                <% } %>
                <% if (user && user.mClass === 'admin') { %>
                  <a href="/member" class="btn btn-warning text-dark btn-action"><i class="bi bi-people me-1"></i> จัดการสมาชิก</a>
                  <!-- add strength menu -->
                  <a href="/strength" class="btn btn-outline-primary btn-action"><i class="bi bi-shield-lock me-1"></i> จัดการความเข้มแข็ง</a>
                  <!-- จัดการ suggestion menu -->
                  <a href="/suggestion" class="btn btn-outline-info btn-action"><i class="bi bi-lightbulb me-1"></i> คำแนะนำนายทะเบียนสหกรณ์</a>
                <% } %>
                <a href="/gitgum/list" class="btn btn-outline-secondary btn-action"><i class="bi bi-plus-circle me-1"></i> เพิ่มกิจกรรมสำนักงาน</a>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Card -->
        <div class="col-lg-4">
          <div class="card border-0 shadow-lg profile-card h-100 position-relative overflow-hidden">
            <div class="card-body text-center p-4 d-flex flex-column justify-content-center">
              <div class="position-relative d-inline-block mb-3">
                <img src="<%= user.m_img %>" alt="Profile" class="rounded-circle shadow profile-avatar">
                <span class="status-badge bg-success" title="online"></span>
              </div>
              <h4 class="fw-bold mb-1 text-dark"><i class="bi bi-person-badge me-1 text-primary"></i><%= user.fullname %></h4>
              <p class="text-muted mb-3"><i class="bi bi-award me-1"></i> <%= user.position %></p>
              <% if (user && user.mClass === 'kjs') { %>
                <a href="/account/list" class="btn btn-primary w-100 mb-2"><i class="bi bi-piggy-bank me-1"></i> เงินกลุ่ม กจส</a>
              <% } %>
              <a href="/auth/logout" class="btn btn-outline-danger w-100"><i class="bi bi-box-arrow-right me-1"></i> ออกจากระบบ</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Metrics Overview (Optional placeholders) -->
      <div class="row g-3 mb-4 metrics-row">
        <div class="col-6 col-md-3">
          <div class="mini-stat shadow-sm">
            <div class="icon bg-gradient-primary-soft"><i class="bi bi-file-earmark-text"></i></div>
            <div class="text">
              <div class="value"><%= (typeof projectCount !== 'undefined' ? projectCount : 0) %></div>
              <div class="label">โครงการ</div>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="mini-stat shadow-sm">
            <div class="icon bg-gradient-success-soft"><i class="bi bi-book"></i></div>
            <div class="text">
              <div class="value"><%= (typeof commandCount !== 'undefined' ? commandCount : 0) %></div>
              <div class="label">คำสั่ง</div>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="mini-stat shadow-sm">
            <div class="icon bg-gradient-info-soft"><i class="bi bi-graph-up"></i></div>
            <div class="text">
              <div class="value"><%= (activity && activity.length) || 0 %></div>
              <div class="label">กิจกรรม</div>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="mini-stat shadow-sm">
            <div class="icon bg-gradient-warning-soft"><i class="bi bi-people"></i></div>
            <div class="text">
              <div class="value"><%= (typeof memberCount !== 'undefined' ? memberCount : '-') %></div>
              <div class="label">สมาชิก</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Feature Navigation Grid -->
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <a href="/project" class="feature-link">
            <div class="feature-card gradient-red">
              <div class="icon"><i class="bi bi-file-earmark-text"></i></div>
              <h5>โครงการ</h5>
              <p>กิจกรรมต่างๆ</p>
            </div>
          </a>
        </div>
        <div class="col-md-3">
          <a href="/command" class="feature-link">
            <div class="feature-card gradient-teal">
              <div class="icon"><i class="bi bi-book"></i></div>
              <h5>คำสั่งสำนักงาน</h5>
              <p>คำสั่งต่างๆ</p>
            </div>
          </a>
        </div>
        <div class="col-md-3">
          <a href="/rq2" class="feature-link">
            <div class="feature-card gradient-bluegreen">
              <div class="icon"><i class="bi bi-graph-up"></i></div>
              <h5>รายงาน RQ2</h5>
              <p>สำนักงานตรวจบัญชี</p>
            </div>
          </a>
        </div>
        <div class="col-md-3">
          <a href="<%= user.mClass === 'admin' ? '/activeCoop/' : '#' %>" class="feature-link <%= user.mClass === 'admin' ? '' : 'disabled' %>">
            <div class="feature-card gradient-pink">
              <div class="icon"><i class="bi bi-gear"></i></div>
              <h5>ตั้งค่า</h5>
              <p>ระบบอื่นๆ</p>
            </div>
          </a>
        </div>
      </div>

      <!-- Data Sections -->
      <div class="card border-0 shadow-lg mb-4">
        <div class="card-header bg-white border-0 py-3 d-flex align-items-center justify-content-center">
          <h4 class="mb-0"><i class="bi bi-grid-3x3-gap me-2 text-primary"></i>ข้อมูลทั้งหมด</h4>
        </div>
        <div class="card-body p-4">
          <div class="row g-4">
            <!-- รายงานงบการเงิน -->
            <div class="col-lg-6">
              <a href="/finance" class="data-link">
                <div class="data-card">
                  <div class="d-flex align-items-center">
                    <div class="data-icon bg-primary"><i class="bi bi-file-earmark-bar-graph"></i></div>
                    <div class="flex-grow-1 ms-4">
                      <h5 class="text-primary mb-1">รายงานงบการเงิน</h5>
                      <p class="text-muted small mb-0">สหกรณ์/กลุ่มเกษตรกร</p>
                    </div>
                    <i class="bi bi-arrow-right-circle text-primary fs-4"></i>
                  </div>
                </div>
              </a>
            </div>
            <!-- ข้อบังคับ -->
            <div class="col-lg-6">
              <a href="/rule" class="data-link">
                <div class="data-card">
                  <div class="d-flex align-items-center">
                    <div class="data-icon bg-success"><i class="bi bi-journal-text"></i></div>
                    <div class="flex-grow-1 ms-4">
                      <h5 class="text-success mb-1">ข้อบังคับ</h5>
                      <p class="text-muted small mb-0">สหกรณ์/กลุ่มเกษตรกร</p>
                    </div>
                    <i class="bi bi-arrow-right-circle text-success fs-4"></i>
                  </div>
                </div>
              </a>
            </div>
            <!-- รายงานกิจการ -->
            <div class="col-lg-6">
              <a href="/business" class="data-link">
                <div class="data-card">
                  <div class="d-flex align-items-center">
                    <div class="data-icon bg-info"><i class="bi bi-people"></i></div>
                    <div class="flex-grow-1 ms-4">
                      <h5 class="text-info mb-1">รายงานกิจการ</h5>
                      <p class="text-muted small mb-0">สหกรณ์/กลุ่มเกษตรกร</p>
                    </div>
                    <i class="bi bi-arrow-right-circle text-info fs-4"></i>
                  </div>
                </div>
              </a>
            </div>
            <!-- ระเบียบ -->
            <div class="col-lg-6">
              <a href="/rabiab" class="data-link">
                <div class="data-card">
                  <div class="d-flex align-items-center">
                    <div class="data-icon bg-warning"><i class="bi bi-bar-chart"></i></div>
                    <div class="flex-grow-1 ms-4">
                      <h5 class="text-warning mb-1">ระเบียบ</h5>
                      <p class="text-muted small mb-0">สหกรณ์/กลุ่มเกษตรกร</p>
                    </div>
                    <i class="bi bi-arrow-right-circle text-warning fs-4"></i>
                  </div>
                </div>
              </a>
            </div>
            <!-- การขอใช้รถยนต์ -->
            <div class="col-lg-6">
              <a href="/usecar" class="data-link">
                <div class="data-card">
                  <div class="d-flex align-items-center">
                    <div class="data-icon bg-dark"><i class="bi bi-database"></i></div>
                    <div class="flex-grow-1 ms-4">
                      <h5 class="text-dark mb-1">การขอใช้รถยนต์</h5>
                      <p class="text-muted small mb-0">ข้อมูลและรายงาน</p>
                    </div>
                    <i class="bi bi-arrow-right-circle text-dark fs-4"></i>
                  </div>
                </div>
              </a>
            </div>
            <!-- วงกู้ยืม/ค้ำประกัน -->
            <div class="col-lg-6">
              <a href="/vong" class="data-link">
                <div class="data-card">
                  <div class="d-flex align-items-center">
                    <div class="data-icon bg-danger"><i class="bi bi-cash-coin"></i></div>
                    <div class="flex-grow-1 ms-4">
                      <h5 class="text-danger mb-1">วงกู้ยืม/ค้ำประกัน</h5>
                      <p class="text-muted small mb-0">ของสหกรณ์ / กลุ่มเกษตรกร</p>
                    </div>
                    <i class="bi bi-arrow-right-circle text-danger fs-4"></i>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activities -->
      <div class="card border-0 shadow-sm mb-5">
        <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-clock-history me-2 text-primary"></i>กิจกรรมล่าสุด (10 รายการ)</h5>
          <a href="/activities/create" class="btn btn-primary btn-sm"><i class="bi bi-plus-circle me-1"></i> เพิ่มกิจกรรม</a>
        </div>
        <div class="card-body p-0">
          <ul class="list-group list-group-flush">
            <% (activity || []).forEach((act) => { %>
              <li class="list-group-item activity-item d-flex justify-content-between align-items-center">
                <span>
                  <strong>
                    <%
                      let thaiDate = '-';
                      if (act.date_act) {
                        const dateObj = new Date(act.date_act);
                        if (!isNaN(dateObj)) {
                          const options = { year: 'numeric', month: 'long', day: 'numeric' };
                          thaiDate = dateObj.toLocaleDateString('th-TH', options);
                        }
                      }
                    %>
                    <i class="bi bi-calendar-event text-primary me-1"></i><%= thaiDate %>
                  </strong>
                  <span class="text-muted ms-2"><i class="bi bi-clock"></i> <%= act.act_time || '-' %> น.</span>
                  — <span class="fw-semibold"><%= act.activity %></span>
                  <% if (act.place) { %>
                    <span class="badge rounded-pill bg-light text-dark ms-2"><i class="bi bi-geo-alt-fill text-danger me-1"></i><%= act.place %></span>
                  <% } %>
                </span>
                <% if (user) { %>
                  <a href="/activities/view/<%= act.act_id %>" class="btn btn-sm btn-outline-success"><i class="bi bi-eye"></i></a>
                <% } else { %>
                  <a href="/auth/login" class="btn btn-sm btn-outline-secondary"><i class="bi bi-box-arrow-in-right"></i></a>
                <% } %>
              </li>
            <% }) %>
            <% if (!activity || activity.length === 0) { %>
              <li class="list-group-item text-muted text-center py-4"><i class="bi bi-inbox me-2"></i> ไม่มีรายการกิจกรรม</li>
            <% } %>
          </ul>
        </div>
      </div>

    </div>
  </div>

  <!-- Styles -->
  <style>
    .dashboard-wrapper {background: linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); min-height:100vh;}
    .glass-card {background: rgba(255,255,255,0.9); backdrop-filter: blur(6px); border-radius: 20px;}
    .profile-card {background: linear-gradient(135deg,#ffffff 0%, #f0f4ff 100%); border-radius: 20px;}
    .text-gradient {background: linear-gradient(90deg,#0d6efd,#6610f2); -webkit-background-clip: text; background-clip: text; color: transparent;}
    .profile-avatar {width:120px; height:120px; object-fit:cover; border:4px solid #fff;}
    .status-badge {position:absolute; bottom:6px; right:6px; width:16px; height:16px; border-radius:50%; border:2px solid #fff;}
    .btn-action {font-size:.85rem;}

    /* Metrics */
    .mini-stat {display:flex; align-items:center; gap:12px; background:#fff; border-radius:14px; padding:14px 16px; position:relative; overflow:hidden; transition:.25s;}
    .mini-stat:hover {box-shadow:0 8px 24px rgba(0,0,0,.07); transform:translateY(-4px);}
    .mini-stat .icon {width:46px; height:46px; display:flex; align-items:center; justify-content:center; font-size:1.25rem; border-radius:12px;}
    .mini-stat .value {font-size:1.25rem; font-weight:600; line-height:1;}
    .mini-stat .label {font-size:.75rem; text-transform:uppercase; letter-spacing:.5px; color:#6c757d;}
    .bg-gradient-primary-soft {background:linear-gradient(135deg,#dbeafe,#bfdbfe);} 
    .bg-gradient-success-soft {background:linear-gradient(135deg,#dcfce7,#bbf7d0);} 
    .bg-gradient-info-soft {background:linear-gradient(135deg,#e0f2fe,#bae6fd);} 
    .bg-gradient-warning-soft {background:linear-gradient(135deg,#fef9c3,#fde68a);} 

    /* Feature Cards */
    .feature-link {text-decoration:none;}
    .feature-link.disabled {pointer-events:none; opacity:.5;}
    .feature-card {border-radius:24px; padding:34px 20px 30px; color:#fff; text-align:center; position:relative; overflow:hidden; height:100%; display:flex; flex-direction:column; justify-content:center; gap:6px; transition:.35s;}
    .feature-card .icon {font-size:2.8rem; line-height:1; margin-bottom:8px;}
    .feature-card p {margin:0; font-size:.85rem; opacity:.9;}
    .feature-card:before {content:""; position:absolute; top:-20%; right:-20%; width:60%; height:160%; background:rgba(255,255,255,.15); transform:rotate(25deg); border-radius:40px;}
    .feature-card:hover {transform:translateY(-6px) scale(1.02); box-shadow:0 15px 35px rgba(0,0,0,.18);}  
    .gradient-red {background:linear-gradient(45deg,#ff6b6b,#ff8e8e);} 
    .gradient-teal {background:linear-gradient(45deg,#4ECDC4,#44A08D);} 
    .gradient-bluegreen {background:linear-gradient(45deg,#45B7D1,#96C93D);} 
    .gradient-pink {background:linear-gradient(45deg,#F093FB,#F5576C);} 

    /* Data Cards */
    .data-link {text-decoration:none;}
    .data-card {background:#fff; border-radius:18px; padding:20px 22px; transition:.3s; height:100%; position:relative; overflow:hidden;}
    .data-card:before {content:""; position:absolute; inset:0; background:radial-gradient(circle at 85% -10%,rgba(0,0,0,.08),transparent 60%); opacity:0; transition:.4s;}
    .data-card:hover {transform:translateY(-6px); box-shadow:0 12px 30px -6px rgba(0,0,0,.15);} 
    .data-card:hover:before {opacity:1;} 
    .data-icon {width:58px; height:58px; display:flex; align-items:center; justify-content:center; border-radius:16px; color:#fff; font-size:1.6rem; box-shadow:0 6px 18px rgba(0,0,0,.15);} 
    .data-icon.bg-primary {background:linear-gradient(135deg,#4facfe,#0061ff);} 
    .data-icon.bg-success {background:linear-gradient(135deg,#84fab0,#4caf50);} 
    .data-icon.bg-info {background:linear-gradient(135deg,#5ee7df,#3a8bbf);} 
    .data-icon.bg-warning {background:linear-gradient(135deg,#f6d365,#fda085);} 
    .data-icon.bg-dark {background:linear-gradient(135deg,#434343,#000);} 
    .data-icon.bg-danger {background:linear-gradient(135deg,#f85032,#e73827);} 

    /* Activities */
    .activity-item {font-size:.9rem; transition:.25s;}
    .activity-item:hover {background:rgba(0,0,0,.02);} 

    /* Scroll enhancements */
    ::-webkit-scrollbar {width:10px;} 
    ::-webkit-scrollbar-track {background:#eef1f5;} 
    ::-webkit-scrollbar-thumb {background:#c2cbd6; border-radius:6px;} 
    ::-webkit-scrollbar-thumb:hover {background:#a8b3c2;} 

    @media (max-width: 575.98px){
      .feature-card {padding:26px 16px;}
      .mini-stat {padding:12px 14px;}
      .profile-avatar {width:90px; height:90px;}
    }
  </style>

  <%- include('partials/footer') %>
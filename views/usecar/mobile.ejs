<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Use Car</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body { background:#f5f7fa; font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
    .app-bar { position:sticky; top:0; z-index:100; background:#0d6efd; color:#fff; padding:.85rem 1rem; display:flex; align-items:center; gap:.6rem; box-shadow:0 2px 4px rgba(0,0,0,.15); }
    .app-bar h1 { font-size:1.15rem; margin:0; font-weight:600; letter-spacing:.5px; }
    .card-usecar { border:none; border-radius:16px; background:#fff; box-shadow:0 4px 10px rgba(0,0,0,.06); transition:all .25s; }
    .card-usecar:active { transform:scale(.98); }
    .date-badge { font-size:.75rem; font-weight:600; background:#e7f1ff; color:#0d6efd; padding:.25rem .6rem; border-radius:30px; display:inline-block; }
    .new-badge { font-size:.6rem; background:#28a745; color:#fff; padding:2px 6px; border-radius:12px; margin-left:6px; letter-spacing:.5px; }
    .time { font-size:.75rem; color:#557; }
    .act { font-size:.9rem; font-weight:600; color:#111; }
    .place { font-size:.75rem; color:#666; }
    .fab { position:fixed; bottom:18px; right:18px; width:54px; height:54px; border-radius:50%; background:#0d6efd; color:#fff; display:flex; align-items:center; justify-content:center; font-size:1.4rem; box-shadow:0 6px 16px rgba(13,110,253,.45); text-decoration:none; }
    .modal-header { border:none; }
    .modal-footer { border:none; }
    .list-wrapper { padding:1rem .9rem 5rem; }
    .empty { text-align:center; padding:3rem 1rem; color:#777; }
    @media (min-width:600px){ .card-usecar { cursor:pointer; } }
  </style>
</head>
<body>
  <div class="app-bar">
    <i class="bi bi-truck-front fs-4"></i>
    <h4>ตารางการใช้รถสำนักงานสหกรณ์จังหวัดชัยภูมิ</h4>
  </div>

  <div class="list-wrapper" id="usecarList">
    <% if(!usecars || usecars.length===0){ %>
      <div class="empty">
        <i class="bi bi-inboxes fs-1 d-block mb-2"></i>
        ไม่มีข้อมูลการใช้รถวันนี้
      </div>
    <% } %>
    <% usecars.forEach((u,i)=>{ 
        const d = new Date(u.date_car);
        const opts = { year:'numeric', month:'short', day:'numeric'};
        const dTh = d.toLocaleDateString('th-TH', opts);
        const saved = new Date(u.savedate);
        const isNew = (Date.now() - saved.getTime()) <= 2*24*60*60*1000;
    %>
      <div class="mb-3">
        <div class="card-usecar p-3" data-bs-toggle="modal" data-bs-target="#m<%= u.id_usecar %>">
          <div class="d-flex justify-content-between align-items-start mb-1 w-100">
            <div class="d-flex align-items-center">
              <span class="date-badge"><%= dTh %></span>
              <% if(isNew){ %><span class="new-badge">NEW</span><% } %>
            </div>
            <span class="time"><i class="bi bi-clock"></i> <%= u.time_car %> น.</span>
          </div>
          <div class="act"><i class="bi bi-activity text-primary"></i> <%= u.act_car %></div>
          <div class="place mt-1"><i class="bi bi-geo-alt"></i> <%= u.place_car %></div>
          <div class="place mt-1 text-decoration-underline">
            <i class="bi bi-car-front"></i> 
            <%= u.no_car || '-' %></div>
        </div>
      </div>

      <div class="modal fade" id="m<%= u.id_usecar %>" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content rounded-4">
            <div class="modal-header">
              <h5 class="modal-title">รายละเอียด</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="small text-muted mb-2"><i class="bi bi-calendar-event"></i> <%= dTh %> | <i class="bi bi-clock"></i> <%= u.time_car %> น. <% if(isNew){ %><span class="new-badge">NEW</span><% } %></div>
              <ul class="list-unstyled mb-0">
                <li class="mb-2"><strong>กิจกรรม:</strong> <%= u.act_car %></li>
                <li class="mb-2"><strong>สถานที่:</strong> <%= u.place_car %></li>
                <li class="mb-2"><strong>ทะเบียนรถ:</strong> <%= u.no_car || '-' %></li>
                <li class="mb-2"><strong>ผู้รับผิดชอบ:</strong> <%= u.respon_car || '-' %></li>
                <li class="mb-2"><strong>เลขเล่ม:</strong> <%= u.no_book || '-' %></li>
                <li class="mb-2"><strong>ใช้น้ำมัน:</strong> <%= u.use_refuel || '-' %></li>
                <li class="mb-2"><strong>งบประมาณ:</strong> <%= u.list_budget || '-' %></li>
                <li class="mb-2"><strong>หมายเหตุ:</strong> <%= u.comment_car || '-' %></li>
              </ul>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary w-100" data-bs-dismiss="modal">ปิด</button>
            </div>
          </div>
        </div>
      </div>
    <% }); %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Optional: Pull to refresh (simple)
    let startY=0; let pulling=false;
    document.addEventListener('touchstart',e=>{ if(window.scrollY===0){ startY=e.touches[0].clientY; }});
    document.addEventListener('touchmove',e=>{ if(window.scrollY===0 && e.touches[0].clientY-startY>90 && !pulling){ pulling=true; location.reload(); }});
    document.addEventListener('touchend',()=> pulling=false);
  </script>
</body>
</html>
<%- include('../partials/header') %>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üìã ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå/‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</h2>
    <% if(user) { %>
      <a href="/rabiab/upload" class="btn btn-success">
        <i class="fas fa-plus"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
      </a>
    <% } %>
  </div>

  <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <form method="GET" class="mb-4">
    <div class="row">
      <div class="col-md-8">
        <input type="text" name="search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö" value="<%= search %>">
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        <a href="/rabiab" class="btn btn-secondary">‡∏•‡πâ‡∏≤‡∏á</a>
      </div>
    </div>
  </form>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏∞3‡∏ö -->
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö</th>
          <th>‡∏û.‡∏®.</th>
          <th>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
          <% if(user) { %>
            <th>Actions</th>
          <% } %>
        </tr>
      </thead>
      <tbody>
        <% rabiabs.forEach((rabiab, index) => { %>
          <tr>
            <td>
              <%= rabiab.ra_name %>
              <% 
                const rabiabSavedDate = new Date(rabiab.ra_savedate);
                const currentDate = new Date();
                const diffDays = Math.ceil((currentDate - rabiabSavedDate) / (1000 * 60 * 60 * 24));
              %>
              <% if (diffDays <= 7) { %>
                <img src="https://websitearchive2020.nepa.gov.jm/new/images/gif/new-star.gif" alt="New" class="ms-2" style="width: 45px; height: 32px;" />
              <% } %>
            </td>
            <td><%= rabiab.ra_year %></td>
            <td>
              <%= new Date(rabiab.ra_approvedate).toLocaleDateString('th-TH') %>
            </td>
            <td class="text-nowrap">
              <% if(user) { %>
                <a href="/rabiab/download/<%= rabiab.ra_id %>" class="btn btn-sm btn-outline-primary" target="_blank">
                  <i class="fas fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                </a>
                <% if(user.mClass === 'admin') { %>
                  <form method="POST" action="/rabiab/delete/<%= rabiab.ra_id %>" class="d-inline" 
                        onsubmit="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏∞√ã‡∏ö‡∏ô‡∏µ‡πâ? ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢')">
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      <i class="fas fa-trash"></i> ‡∏•‡∏ö
                    </button>
                  </form>
                <% } %>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if (totalPages > 1) { %>
    <nav>
      <ul class="pagination justify-content-center">
        <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %><%= search ? '&search=' + search : '' %>"><%= i %></a>
          </li>
        <% } %>
      </ul>
    </nav>
  <% } %>
</div>

<%- include('../partials/footer') %>

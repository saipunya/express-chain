<%- include('../partials/header', { title: 'Sangket' }) %>
<div class="container my-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
    <div class="d-flex align-items-center gap-2">
      <h3 class="mb-0">รายการสังเกต (Sangket)</h3>
      <span class="badge bg-secondary text-light">รวม <%= (pagination && pagination.total) || (items?.length||0) %> รายการ</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <form class="d-flex" method="GET" action="">
        <div class="input-group">
          <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
          <input type="text" class="form-control" name="search" placeholder="ค้นหา ชื่อ/รหัส/กลุ่ม" value="<%= search || '' %>">
          <button class="btn btn-primary" type="submit">ค้นหา</button>
          <a href="/sangket" class="btn btn-outline-secondary">ล้าง</a>
        </div>
      </form>
      <a href="/sangket/create" class="btn btn-success"><i class="bi bi-plus-lg me-1"></i> เพิ่ม</a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 80px;" class="text-center">#</th>
              <th>กลุ่ม</th>
              <th>รหัส</th>
              <th>ชื่อ</th>
              <th class="text-nowrap">วันสิ้นปี</th>
              <th class="text-nowrap">รับหนังสือ</th>
              <th class="text-nowrap">รับวันที่</th>
              <th class="text-nowrap">สถานะ</th>
              <th style="width:160px;" class="text-center">การทำงาน</th>
            </tr>
          </thead>
          <tbody>
            <% if (items && items.length) { %>
              <% items.forEach((it, i)=> { %>
                <tr>
                  <td class="text-center"><%= ((pagination?.page||1)-1)*(pagination?.pageSize||10) + i + 1 %></td>
                  <td><span class="badge text-bg-secondary"><%= it.sang_group %></span></td>
                  <td><%= it.sang_code %></td>
                  <td><a href="/sangket/view/<%= it.sang_id %>" class="text-decoration-none"><%= it.sang_name %></a></td>
                  <td class="text-nowrap"><%= it.sang_enddate ? new Date(it.sang_enddate).toISOString().split('T')[0] : '-' %></td>
                  <td><%= it.sang_rabbook || '-' %></td>
                  <td class="text-nowrap"><%= it.sang_rabdate ? new Date(it.sang_rabdate).toISOString().split('T')[0] : '-' %></td>
                  <td><span class="badge text-bg-info"><%= it.sang_status || '-' %></span></td>
                  <td class="text-center text-nowrap">
                    <a href="/sangket/view/<%= it.sang_id %>" class="btn btn-outline-primary btn-sm me-1"><i class="bi bi-eye"></i></a>
                    <a href="/sangket/edit/<%= it.sang_id %>" class="btn btn-warning btn-sm me-1"><i class="bi bi-pencil-square"></i></a>
                    <form action="/sangket/delete/<%= it.sang_id %>" method="POST" style="display:inline" onsubmit="return confirm('ลบรายการนี้หรือไม่?')">
                      <button class="btn btn-danger btn-sm" type="submit"><i class="bi bi-trash"></i></button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="9">
                  <div class="text-center py-4 text-muted">
                    <i class="bi bi-inbox display-6 d-block mb-2"></i>
                    ไม่พบข้อมูล
                  </div>
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <% if (pagination && pagination.totalPages > 1) { %>
    <nav class="mt-3">
      <ul class="pagination justify-content-center">
        <li class="page-item <%= pagination.hasPrev ? '' : 'disabled' %>">
          <a class="page-link" href="?search=<%= encodeURIComponent(search||'') %>&page=<%= (pagination.page-1) %>&pageSize=<%= pagination.pageSize %>">ก่อนหน้า</a>
        </li>
        <% for (let p = 1; p <= pagination.totalPages; p++) { %>
          <li class="page-item <%= p===pagination.page ? 'active' : '' %>"><a class="page-link" href="?search=<%= encodeURIComponent(search||'') %>&page=<%= p %>&pageSize=<%= pagination.pageSize %>"><%= p %></a></li>
        <% } %>
        <li class="page-item <%= pagination.hasNext ? '' : 'disabled' %>">
          <a class="page-link" href="?search=<%= encodeURIComponent(search||'') %>&page=<%= (pagination.page+1) %>&pageSize=<%= pagination.pageSize %>">ถัดไป</a>
        </li>
      </ul>
    </nav>
  <% } %>
</div>
<%- include('../partials/footer') %>

<%- include('../partials/header', { title: 'Commands' }) %>
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>คำ<lemma่ง</h3>
    <form class="d-flex" method="GET" action="">
      <input type="text" class="form-control me-2" name="search" placeholder="ค้นหาเรื่อง/จาก" value="<%= search || '' %>">
      <button class="btn btn-outline-primary" type="submit">ค้นหา</button>
      <a href="/command" class="btn btn-outline-secondary ms-2">ล้าง</a>
    </form>
    <% if(user && (user.mClass=='admin' || user.mClass=='pbt')){ %>
    <a href="/command/create" class="btn btn-primary">Add</a>
    <% } %>
  </div>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>No</th>
        <th>Date</th>
        <th>From</th>
        <th>Title</th>
        <th>File</th>
        <% if(user && (user.mClass=='pbt' || user.mClass=='admin')){ %>
        <th>Actions</th>
        <% } %>
      </tr>
    </thead>
    <tbody>
      <% commands.forEach(c => { %>
        <tr>
          <td><%= c.cmd_no %></td>
          <td class="text-nowrap">
            <% const thaiDate = new Date(c.cmd_date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' }); %>
            <%= thaiDate %>
          </td>
          <td><%= c.cmd_from %></td>
          <td><%= c.cmd_title %></td>
          <td>
            <% if (user) { %>
              <a href="/command/download/<%= c.cmd_id %>" class="btn btn-sm btn-outline-primary" target="_blank">
                <i class="bi bi-file-pdf-fill"></i>
              </a>
            <% }else{ %>
              <a href="/auth/login" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-file-pdf-fill"></i>
              </a>
            <% } %>
          </td>
          <% if(user && (user.mClass=='pbt' || user.mClass=='admin')){ %>
          <td class="text-nowrap">
            <a href="/command/edit/<%= c.cmd_id %>" class="btn btn-warning btn-sm">Edit</a>
            <form action="/command/delete/<%= c.cmd_id %>" method="POST" style="display:inline" onsubmit="return confirm('Delete?')">
              <button class="btn btn-danger btn-sm" type="submit">Delete</button>
            </form>
          </td>
          <% } %>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
<%- include('../partials/footer') %>
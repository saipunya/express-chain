<%- include('../partials/header.ejs') %>
  <div class="container mt-5">
    <h1 class="mb-4">กิจกรรมทั้งหมด</h1>
    <% if(user && (user.mClass==='pbt' || user.mClass==='admin')){%>
    <a href="/activities/create" class="btn btn-primary mb-3">เพิ่มกิจกรรมใหม่</a>
    <% } %>
    
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>วันที่</th>
          <th>กิจกรรม</th>
          <th>สถานที่</th>
          <th>จัดการ</th>
        </tr>
      </thead>
      <tbody>
        <% function formatThaiDate(dateStr) {
             const months = [
               "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน",
               "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
             ];
             const d = new Date(dateStr);
             if (isNaN(d)) return dateStr;
             return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
           }
        %>
        <% activities.forEach(activity => { %>
          <tr>
            <!-- thaidate -->
            <td><%= formatThaiDate(activity.date_act) %> <span class="text-danger">[<%= activity.act_time + ' น.'  %>]</span></td>
            <td><%= activity.activity %></td>
            <td><%= activity.place %></td>
            <td class="text-nowrap">
              <a href="/activities/view/<%= activity.act_id %>" class="btn btn-info btn-sm">ดู</a>
              <% if(user && (user.mClass==='pbt' || user.mClass==='admin')) { %>
              <a href="/activities/edit/<%= activity.act_id %>" class="btn btn-warning btn-sm">แก้ไข</a>
              <a href="/activities/delete/<%= activity.act_id %>" class="btn btn-danger btn-sm" onclick="return confirm('ยืนยันการลบ?')">ลบ</a>
            <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<%- include('../partials/footer.ejs') %>

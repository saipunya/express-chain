<%- include('./partials/header') %>

<form action="/business/upload" method="POST" enctype="multipart/form-data">
  <h3 class="mt-4">ЁЯУд р╕нр╕▒р╕Юр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Шр╕╕р╕гр╕Бр╕┤р╕И</h3>
  
  <div class="mb-3">
    <label for="c_group" class="form-label">р╕Бр╕ер╕╕р╣Ир╕бр╕кр╣Ир╕Зр╕кр╕лр╕Бр╕гр╕Ур╣М</label>
    <select id="c_group" class="form-select" required>
      <option value="">++ р╣Вр╕Ыр╕гр╕Фр╣Ар╕ер╕╖р╕нр╕Б ++</option>
      <option value="group1">р╕Бр╕ер╕╕р╣Ир╕бр╕кр╣Ир╕Зр╕кр╕лр╕Бр╕гр╕Ур╣М 1</option>
      <option value="group2">р╕Бр╕ер╕╕р╣Ир╕бр╕кр╣Ир╕Зр╕кр╕лр╕Бр╕гр╕Ур╣М 2</option>
      <option value="group3">р╕Бр╕ер╕╕р╣Ир╕бр╕кр╣Ир╕Зр╕кр╕лр╕Бр╕гр╕Ур╣М 3</option>
      <option value="group4">р╕Бр╕ер╕╕р╣Ир╕бр╕кр╣Ир╕Зр╕кр╕лр╕Бр╕гр╕Ур╣М 4</option>
      <option value="group5">р╕Бр╕ер╕╕р╣Ир╕бр╕кр╣Ир╕Зр╕кр╕лр╕Бр╕гр╕Ур╣М 5</option>
    </select>
  </div>
  
  <div class="mb-3">
    <label for="bu_code" class="form-label">р╕кр╕лр╕Бр╕гр╕Ур╣М/р╕Бр╕ер╕╕р╣Ир╕бр╣Ар╕Бр╕йр╕Хр╕гр╕Бр╕г</label>
    <select name="bu_code" id="bu_code" class="form-select" required>
      <option value="">++р╣Вр╕Ыр╕гр╕Фр╣Ар╕ер╕╖р╕нр╕Б++</option>
    </select>
  </div>
  <input type="hidden" name="bu_name" id="bu_name">
  
  <div class="mb-3">
    <label for="bu_endyear" class="form-label">р╕Ыр╕╡р╕кр╕┤р╣Йр╕Щр╕кр╕╕р╕Ф</label>
    <input type="number" name="bu_endyear" id="bu_endyear" class="form-control" required>
  </div>
  
  <div class="mb-3">
    <label>р╣Др╕Яр╕ер╣М PDF</label>
    <input type="file" name="file" class="form-control" required>
  </div>
  
  <button type="submit" class="btn btn-success">р╕нр╕▒р╕Юр╣Вр╕лр╕ер╕Ф</button>
</form>

<script>
  const cGroupSelect = document.getElementById('c_group');
  const cCodeSelect = document.getElementById('bu_code');
  const cNameInput = document.getElementById('bu_name');

  cGroupSelect.addEventListener('change', async function () {
    const group = this.value;
    cCodeSelect.innerHTML = '<option value="">р╣Вр╕лр╕ер╕Ф...</option>';

    if (!group) {
      cCodeSelect.innerHTML = '<option value="">-- р╣Ар╕ер╕╖р╕нр╕Бр╕Бр╕ер╕╕р╣Ир╕бр╕Бр╣Ир╕нр╕Щ --</option>';
      return;
    }

    try {
      const response = await fetch(`/business/coops/${group}`);
      const data = await response.json();
      
      if (Array.isArray(data) && data.length > 0) {
        cCodeSelect.innerHTML = '<option value="">-- р╣Ар╕ер╕╖р╕нр╕Бр╕кр╕лр╕Бр╕гр╕Ур╣М --</option>';
        data.forEach(coop => {
          const option = document.createElement('option');
          option.value = coop.c_code;
          option.text = coop.c_name;
          cCodeSelect.appendChild(option);
        });
      } else {
        cCodeSelect.innerHTML = '<option value="">р╣Др╕бр╣Ир╕Юр╕Ър╕кр╕лр╕Бр╕гр╕Ур╣Мр╣Гр╕Щр╕Бр╕ер╕╕р╣Ир╕б</option>';
      }
    } catch (error) {
      console.error('р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕лр╕Бр╕гр╕Ур╣Мр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з:', error);
      cCodeSelect.innerHTML = '<option value="">р╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф</option>';
    }
  });

  cCodeSelect.addEventListener('change', function () {
    const selectedOption = this.options[this.selectedIndex];
    cNameInput.value = selectedOption.text !== '-- р╣Ар╕ер╕╖р╕нр╕Бр╕кр╕лр╕Бр╕гр╕Ур╣М --' ? selectedOption.text : '';
  });
</script>

<%- include('./partials/footer') %>
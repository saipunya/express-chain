<%- include('./partials/header') %>

<div class="container mt-4">
  <h3 class="mb-4">üìã ‡πÑ‡∏ü‡∏•‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>

  <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <div class="row mb-3">
    <div class="col-md-6">
      <form method="GET" action="/business">
        <div class="input-group">
          <input type="text" name="search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå" value="<%= search %>">
          <button class="btn btn-outline-secondary" type="submit">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
          <a href="/business" class="btn btn-outline-danger">‡∏•‡πâ‡∏≤‡∏á</a>
        </div>
      </form>
    </div>
    <div class="col-md-6 text-end">
      <% if(user && user.mClass === 'kts' || user && user.mClass === 'admin') { %>
        <a href="/business/upload" class="btn btn-success">
          <i class="bi bi-plus-circle"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
        </a>
      <% } %>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå/‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</th>
          <th>‡∏õ‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
          <th>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏î‡∏¢</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody>
        <% if(fileAll && fileAll.length > 0) { %>
          <% fileAll.forEach(file => { %>
            <tr>
              <td><%= file.bu_name %></td>
              <td><%= file.end_date %> %><%= file.bu_endyear %></td>
              <td><%= file.bu_saveby %></td>
              <td>
                <% const date = new Date(file.bu_savedate); %>
                <% const options = { year: 'numeric', month: 'long', day: 'numeric' }; %>
                <% const thaiDate = date.toLocaleDateString('th-TH', options); %>
                <%= thaiDate %>
              </td>
              <td>
                <% if(user) { %>
                  <a href="/business/download/<%= file.bu_id %>" target="_blank" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                  </a>
                  <% if(user.mClass === 'admin' || user.mClass === 'kbs') { %>
                    <a href="/business/delete/<%= file.bu_id %>" class="btn btn-sm btn-outline-danger" 
                       onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?')">
                      <i class="bi bi-trash"></i> ‡∏•‡∏ö
                    </a>
                  <% } %>
                <% } else { %>
                  <a href="/auth/login" class="btn btn-sm btn-outline-primary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                <% } %>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="5" class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if(totalPages > 1) { %>
    <nav>
      <ul class="pagination justify-content-center">
        <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
            <a class="page-link" href="/business?page=<%= i %><%= search ? '&search=' + encodeURIComponent(search) : '' %>">
              <%= i %>
            </a>
          </li>
        <% } %>
      </ul>
    </nav>
  <% } %>
</div>

<%- include('./partials/footer') %>
<%- include('../partials/header.ejs') %>

<div class="container my-5">
  <h1 class="mb-4 text-center">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå / ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</h1>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <form method="GET" action="/chamra" class="row g-3 mb-4 align-items-end">
    <div class="col-md-4">
      <label for="search" class="form-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå</label>
      <input type="text" id="search" name="search" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå" value="<%= search %>">
    </div>
    <div class="col-md-3">
      <label for="c_status" class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
      <select id="c_status" name="c_status" class="form-select">
        <option value="">-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>
        <option value="‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" <%= c_status === '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : '' %>>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
        <option value="‡πÄ‡∏•‡∏¥‡∏Å" <%= c_status === '‡πÄ‡∏•‡∏¥‡∏Å' ? 'selected' : '' %>>‡πÄ‡∏•‡∏¥‡∏Å</option>
        <option value="‡∏ñ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠" <%= c_status === '‡∏ñ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠' ? 'selected' : '' %>>‡∏ñ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="gr_step" class="form-label">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</label>
      <select id="gr_step" name="gr_step" class="form-select">
        <option value="">-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô --</option>
        <% for (let i = 0; i <= 6; i++) { %>
          <option value="<%= i %>" <%= gr_step == i ? 'selected' : '' %>>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô <%= i %></option>
        <% } %>
      </select>
    </div>
    <div class="col-md-2 d-grid">
      <button type="submit" class="btn btn-primary">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
    </div>
  </form>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>‡∏£‡∏´‡∏±‡∏™</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå</th>
          <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
          <th>‡∏°‡∏≤‡∏ï‡∏£‡∏≤</th>
          <th>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody>
        <% if (data.length === 0) { %>
          <tr>
            <td colspan="7" class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
          </tr>
        <% } else { %>
          <% data.forEach(item => { %>
            <tr>
              <td><%= item.de_code %></td>
              <td><%= item.c_name %></td>
              <td><%= item.c_status %></td>
              <td><%= item.c_person %></td>
              <td><%= item.de_case %></td>
              <td><%= item.de_target1 %> / <%= item.de_target2 %></td>
              <td>
                <a href="/chamra/<%= item.de_code %>/view" class="btn btn-sm btn-info me-1">‡∏î‡∏π</a>
                <a href="/chamra/<%= item.de_code %>/edit" class="btn btn-sm btn-warning me-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                <form method="POST" action="/chamra/<%= item.de_code %>?_method=DELETE" style="display:inline;">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')">‡∏•‡∏ö</button>
                </form>
              </td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      <% for (let i = 1; i <= Math.ceil(pagination.total_records / pagination.page_size); i++) { %>
        <li class="page-item <%= i === pagination.page ? 'active' : '' %>">
          <a class="page-link" href="?search=<%= search %>&c_status=<%= c_status %>&gr_step=<%= gr_step %>&page=<%= i %>&page_size=<%= pagination.page_size %>">
            <%= i %>
          </a>
        </li>
      <% } %>
    </ul>
  </nav>
</div>
<%- include('../partials/footer.ejs') %>

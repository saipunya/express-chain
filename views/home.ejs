<%- include('partials/header',{title : 'ระบบสารสนเทศและเครือข่ายสหกรณ์ในจังหวัดภูมิ' }) %>

<!-- Added: Required Chart.js + plugin (fix graphs not showing) -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<!-- Added: FullCalendar (for Activities calendar) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" />
<script defer src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales-all.global.min.js"></script>

<!-- ================= Modern Global Styles (Refactored) ================ -->
<style>
  :root {
    --primary: #10b981;
    --primary-light: #d1fae5;
    --primary-lighter: #ecfdf5;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --border-color: #e5e7eb;
    --bg-light: #f9fafb;
    --bg-lighter: #ffffff;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --radius-sm: 0.375rem;
    --radius: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: 0.15s ease;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --color-bg: #0f172a;
      --color-surface: #1e293b;
      --color-border: #334155;
      --color-text: #e2e8f0;
      --color-muted: #94a3b8;
      --glass: rgba(30, 41, 59, 0.75);
      --shadow-sm: 0 4px 10px -2px rgba(0, 0, 0, .55);
      --shadow: 0 8px 28px -6px rgba(0, 0, 0, .65);
      --shadow-hover: 0 16px 44px -10px rgba(0, 0, 0, .85);
    }

    .modern-card,
    .hero-shell {
      border: 1px solid var(--color-border);
    }

    .quick-nav a {
      color: var(--color-muted);
    }

    .quick-nav a.active {
      color: #fff;
    }
  }

  * {
    box-sizing: border-box;
  }

  body {
    background: var(--bg-light);
    color: var(--text-primary);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Enhanced Typography and Visual Hierarchy */
  h1, h2, h3, h4, h5, h6 {
    font-weight: 700;
    letter-spacing: -0.025em;
    line-height: 1.2;
    color: var(--text-primary);
    margin-bottom: 0.5em;
  }

  h1 {
    font-size: 2.5rem;
    font-weight: 800;
  }

  h2 {
    font-size: 2rem;
    font-weight: 700;
  }

  h3 {
    font-size: 1.75rem;
    font-weight: 600;
  }

  h4 {
    font-size: 1.5rem;
    font-weight: 600;
  }

  h5 {
    font-size: 1.25rem;
    font-weight: 600;
  }

  h6 {
    font-size: 1.125rem;
    font-weight: 600;
  }

  p {
    margin-bottom: 1.25rem;
    line-height: 1.8;
  }

  .lead {
    font-size: 1.25rem;
    font-weight: 400;
    line-height: 1.6;
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
  }

  .card-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .card-text {
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--text-secondary);
  }

  .small {
    font-size: 0.875rem;
    line-height: 1.5;
  }

  .text-muted {
    color: var(--text-secondary) !important;
    font-weight: 400;
  }

  /* Enhanced Spacing */
  .section-block {
    padding-block: 3rem;
  }

  .modern-card {
    margin-bottom: 2rem;
  }

  .modern-card .card-body {
    padding: 2rem;
  }

  .modern-card .card-header {
    padding: 1.25rem 2rem;
  }

  .modern-card .card-footer {
    padding: 1rem 2rem;
  }

  .table-responsive {
    margin-bottom: 1.5rem;
  }

  .table {
    margin-bottom: 0;
  }

  .table th,
  .table td {
    padding: 1rem 0.75rem;
    vertical-align: middle;
  }

  .table thead th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.875rem;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--primary);
  }

  /* Enhanced Lists */
  .list-group-item {
    padding: 1rem 1.25rem;
    border-left: 4px solid transparent;
    transition: all 0.3s ease;
  }

  .list-group-item:hover {
    border-left-color: var(--primary);
    background-color: var(--primary-light);
  }

  /* Enhanced Forms */
  .form-control {
    border-radius: 0.5rem;
    border: 2px solid #e5e7eb;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(5, 150, 105, 0.25);
  }

  .form-label {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
  }

  /* Enhanced Modal Typography */
  .modal-title {
    font-size: 1.25rem;
    font-weight: 700;
  }

  .modal-body {
    font-size: 0.95rem;
    line-height: 1.6;
  }

  /* Enhanced Button Typography */
  .btn {
    font-weight: 600;
    letter-spacing: 0.3px;
    text-transform: none;
  }

  .btn-sm {
    font-size: 0.875rem;
    font-weight: 600;
  }

  /* Enhanced Badge Typography */
  .badge {
    font-weight: 600;
    letter-spacing: 0.3px;
    font-size: 0.75rem;
  }

  /* Enhanced Alert Typography */
  .alert {
    font-size: 0.95rem;
    line-height: 1.6;
    border-radius: 0.75rem;
    border: none;
  }

  .alert-heading {
    font-size: 1.125rem;
    font-weight: 700;
  }

  .display-1 {
    font-size: 5rem;
    font-weight: 800;
    line-height: 1;
    letter-spacing: -0.05em;
  }

  .display-2 {
    font-size: 4.5rem;
    font-weight: 800;
    line-height: 1;
    letter-spacing: -0.05em;
  }

  .display-3 {
    font-size: 4rem;
    font-weight: 700;
    line-height: 1;
    letter-spacing: -0.025em;
  }

  .display-4 {
    font-size: 3.5rem;
    font-weight: 700;
    line-height: 1;
    letter-spacing: -0.025em;
  }

  .display-5 {
    font-size: 3rem;
    font-weight: 700;
    line-height: 1;
    letter-spacing: -0.025em;
  }

  .display-6 {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1;
    letter-spacing: -0.025em;
  }

  /* Enhanced Text Colors */
  .text-primary {
    color: var(--primary) !important;
    font-weight: 500;
  }

  .text-secondary {
    color: var(--text-secondary) !important;
  }

  .text-muted {
    color: var(--text-muted) !important;
    font-size: 0.875rem;
  }

  .text-success {
    color: #059669 !important;
    font-weight: 500;
  }

  .text-warning {
    color: #d97706 !important;
    font-weight: 500;
  }

  .text-danger {
    color: #dc2626 !important;
    font-weight: 500;
  }

  .text-info {
    color: #0284c7 !important;
    font-weight: 500;
  }

  /* Enhanced Section Titles */
  .section-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 2rem;
    position: relative;
    display: inline-block;
    padding-bottom: 0.75rem;
  }

  .section-title::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, var(--primary) 0%, #059669 50%, transparent 100%);
    border-radius: 2px;
  }

  .section-title i {
    margin-right: 0.75rem;
    font-size: 1.5rem;
  }

  /* Card Title Enhancements */
  .card-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .card-subtitle {
    font-size: 0.875rem;
    color: var(--text-muted);
    font-weight: 400;
    margin-bottom: 0.5rem;
  }

  .card-text {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  /* Table Typography */
  .table {
    font-size: 0.875rem;
  }

  .table thead th {
    font-weight: 600;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.75rem;
    border-bottom: 2px solid var(--border-color);
  }

  .table tbody td {
    color: var (--text-secondary);
    vertical-align: middle;
  }

  /* Badge Typography */
  .badge {
    font-weight: 500;
    font-size: 0.75rem;
    letter-spacing: 0.025em;
  }

  /* Button Typography */
  .btn {
    font-weight: 500;
    letter-spacing: 0.025em;
    text-decoration: none;
  }

  .btn-sm {
    font-size: 0.875rem;
  }

  /* Link Typography */
  a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  a:hover {
    color: #059669;
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 2px;
  }

  /* Blockquote */
  blockquote {
    border-left: 4px solid var(--primary);
    padding-left: 1.5rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: var(--text-secondary);
  }

  blockquote p {
    margin-bottom: 0;
  }

  /* Code Typography */
  code {
    background: var(--bg-light);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    color: var(--primary);
    font-weight: 500;
  }

  pre {
    background: var(--bg-light);
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    border: 1px solid var(--border-color);
  }

  pre code {
    background: none;
    padding: 0;
    color: var(--text-primary);
  }

  a {
    color: var(--primary);
    text-decoration: none;
    transition: var(--transition);
  }

  a:hover {
    color: #059669;
    transform: translateY(-1px);
  }

  .container,
  .container-lg {
    max-width: 1200px;
  }

  /* Hero Section */
  .hero-shell {
    background: linear-gradient(135deg, var(--primary) 0%, #059669 100%);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    overflow: hidden;
    position: relative;
    box-shadow: var(--shadow-lg);
    min-height: 320px;
    color: white;
  }

  .hero-shell:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
    pointer-events: none;
  }

  @keyframes heroGlow {
    0% {
      opacity: 0.7;
    }

    100% {
      opacity: 1;
    }
  }

  .hero-img-wrap {
    position: relative;
    height: 100%;
  }

  .hero-img-wrap img {
    object-fit: cover;
    width: 100%;
    height: 100%;
    aspect-ratio: 4/3;
  }

  @media (min-width: 992px) {
    .hero-img-wrap img {
      aspect-ratio: unset;
    }
  }

  .glass-pane {
    background: var(--glass);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border-left: 1px solid rgba(255, 255, 255, 0.3);
  }

  /* Hero image full cover override (added) */
  .hero-img-wrap {
    min-height: 380px;
    position: relative;
    overflow: hidden;
  }

  .hero-img-wrap::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent 50%, rgba(0, 0, 0, 0.1) 100%);
    pointer-events: none;
  }

  .hero-img-wrap>img.hero-cover-img,
  .hero-img-wrap>img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .hero-shell:hover .hero-img-wrap>img {
    transform: none;
  }

  /* Enhanced Cards / Sections */
  .card {
    border-radius: var(--radius-xl);
    overflow: hidden;
    border: 1px solid var(--border-color);
    background: var(--bg-lighter);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary) 0%, #059669 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .card:hover::before {
    opacity: 1;
  }

  .modern-card {
    border: 1px solid var(--border-color);
    background: var(--bg-lighter);
    border-radius: var(--radius-xl);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .modern-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    border-color: var(--primary);
  }

  .modern-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  .modern-card:hover::after {
    opacity: 1;
  }

  .modern-card::before {
    display: none;
    content: none;
  }

  .card-gradient-bar {
    display: block;
    height: 4px;
    background: linear-gradient(90deg, var(--primary) 0%, #059669 100%);
    position: relative;
    overflow: hidden;
  }

  .card-gradient-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  .modern-card .card-body {
    padding: 2rem;
    position: relative;
    z-index: 1;
  }

  .modern-card .card-header {
    background: transparent;
    border-bottom: 1px solid var(--border-color);
    padding: 1.25rem 2rem;
    font-weight: 600;
    position: relative;
    z-index: 1;
  }

  .modern-card .card-footer {
    background: var(--bg-light);
    border-top: 1px solid var(--border-color);
    padding: 1.25rem 2rem;
    position: relative;
    z-index: 1;
  }

  .table-responsive {
    border-radius: var(--radius-lg);
    background: var(--bg-lighter);
    border: 1px solid var(--border-color);
    overflow: visible;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .section-block {
      padding-block: 1.5rem;
    }

    .hero-section {
      padding: 2rem 0;
    }

    .hero-title {
      font-size: 2rem !important;
      line-height: 1.2;
    }

    .hero-subtitle {
      font-size: 1rem !important;
    }

    .stats-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .stats-card {
      padding: 1.5rem 1rem;
    }

    .section-title {
      font-size: 1.5rem !important;
    }

    .card-header {
      padding: 0.75rem 1rem;
    }

    .btn-group-vertical {
      flex-direction: column;
    }

    .table-responsive {
      font-size: 0.875rem;
    }

    .chart-container {
      height: 200px !important;
    }

    .chart-container--sm {
      height: 150px !important;
    }

    .avatar {
      width: 35px !important;
      height: 35px !important;
    }
  }

  @media (max-width: 576px) {
    .container-lg {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    .hero-section .container {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    .hero-title {
      font-size: 1.75rem !important;
    }

    .section-title {
      font-size: 1.25rem !important;
    }

    .stats-card h3 {
      font-size: 1.5rem !important;
    }

    .stats-card p {
      font-size: 0.875rem !important;
    }

    .table-responsive {
      font-size: 0.8rem;
    }

    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

    .card-body {
      padding: 1rem 0.75rem;
    }
  }

  /* Section layout */
  .section-block {
    padding-block: 2rem;
    content-visibility: auto;
    contain-intrinsic-size: 800px;
  }

  /* Enhanced colors and gradients */
  :root {
    --primary: #059669;
    --primary-light: #ecfdf5;
    --secondary: #6b7280;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    --light: #f9fafb;
    --dark: #111827;
    --gradient-primary: linear-gradient(135deg, #059669 0%, #10b981 100%);
    --gradient-secondary: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  .section-block.compact {
    padding-block: 2rem;
  }

  .section-block.bg-light {
    background: var(--bg-light);
  }

  .section-block.bg-white {
    background: var(--bg-lighter);
  }

  .section-heading {
    font-weight: 700;
    letter-spacing: 0.5px;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    position: relative;
    margin-bottom: 1.5rem;
    font-size: 1.25rem;
    color: var(--text-primary);
  }

  .section-heading:after {
    content: "";
    height: 4px;
    width: 50%;
    background: linear-gradient(90deg, var(--primary) 0%, #059669 100%);
    position: absolute;
    left: 50%;
    bottom: -8px;
    transform: translateX(-50%);
    border-radius: 4px;
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 2rem;
    position: relative;
    display: inline-block;
  }

  .section-title i {
    margin-right: 0.5rem;
  }

  /* Lists */
  .list-group-item {
    border: 0;
    border-bottom: 1px solid var(--color-border);
    background: transparent;
  }

  .list-group-item:last-child {
    border-bottom: 0;
  }

  /* Quick Nav */
  .quick-nav-wrapper {
    margin-top: -1.5rem;
    margin-bottom: 2rem;
    position: sticky;
    top: 70px;
    z-index: 1029;
  }

  .quick-nav {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    scrollbar-width: none;
    padding: 0.75rem 1rem;
    background: #ffffff;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    box-shadow: none;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
  }

  .quick-nav::-webkit-scrollbar {
    display: none;
  }

  .quick-nav a {
    white-space: nowrap;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.45rem 0.9rem;
    border-radius: 0.5rem;
    text-decoration: none;
    background: #f8f9fa;
    color: #495057;
    border: 1px solid #dee2e6;
    transition: var(--transition-fast);
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    animation: none;
  }

  @keyframes navSlideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Staggered Animation Delay for Quick Nav Items */
  .quick-nav a:nth-child(1) {
    animation-delay: 0.05s;
  }

  .quick-nav a:nth-child(2) {
    animation-delay: 0.1s;
  }

  .quick-nav a:nth-child(3) {
    animation-delay: 0.15s;
  }

  .quick-nav a:nth-child(4) {
    animation-delay: 0.2s;
  }

  .quick-nav a:nth-child(5) {
    animation-delay: 0.25s;
  }

  .quick-nav a:nth-child(6) {
    animation-delay: 0.3s;
  }

  .quick-nav a:nth-child(7) {
    animation-delay: 0.35s;
  }

  .quick-nav a:nth-child(8) {
    animation-delay: 0.4s;
  }

  .quick-nav a:nth-child(9) {
    animation-delay: 0.45s;
  }

  .quick-nav a:nth-child(10) {
    animation-delay: 0.5s;
  }

  .quick-nav a:nth-child(11) {
    animation-delay: 0.55s;
  }

  .quick-nav a:nth-child(12) {
    animation-delay: 0.6s;
  }

  .quick-nav a:nth-child(13) {
    animation-delay: 0.65s;
  }

  .quick-nav a:nth-child(14) {
    animation-delay: 0.7s;
  }

  .quick-nav a:nth-child(15) {
    animation-delay: 0.75s;
  }

  .quick-nav a:nth-child(16) {
    animation-delay: 0.8s;
  }

  .quick-nav a:nth-child(17) {
    animation-delay: 0.85s;
  }

  .quick-nav a:nth-child(18) {
    animation-delay: 0.9s;
  }

  .quick-nav a:nth-child(19) {
    animation-delay: 0.95s;
  }

  .quick-nav a:nth-child(20) {
    animation-delay: 1.0s;
  }

  .quick-nav a i {
    font-size: 0.9rem;
    opacity: 0.8;
  }

  .quick-nav a:hover {
    background: #e9ecef;
    transform: none;
    box-shadow: none;
  }

  .quick-nav a.active {
    background: #0d6efd;
    color: #fff;
    border-color: #0d6efd;
    box-shadow: none;
  }

  .quick-nav a.active i {
    opacity: 1;
  }

  /* Animations */
  .reveal {
    opacity: 1;
    transform: none;
    transition: none;
  }

  .reveal.in {
    opacity: 1;
    transform: none;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes pulse {

    0%,
    100% {
      transform: scale(1);
    }

    50% {
      transform: scale(1.05);
    }
  }

  @keyframes shimmer {
    0% {
      background-position: -200% 0;
    }

    100% {
      background-position: 200% 0;
    }
  }

  .soft-badge {
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    color: #334155;
    border: 1px solid #cbd5e1;
    font-weight: 500;
    padding: 0.35rem 0.75rem;
    border-radius: 2rem;
    font-size: 0.8rem;
  }

  /* Responsive helpers for avatars, metric icons, and small UI pieces */
  .metric-icon {
    width: 60px;
    height: 60px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 1.75rem;
  }

  .metric-icon i {
    font-size: 1.75rem;
  }

  .avatar {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 50%;
  }

  .avatar-lg {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 50%;
    border: 4px solid rgba(255, 255, 255, 0.8);
  }

  .col-index {
    width: 56px;
  }

  .small-dot {
    font-size: 8px;
    line-height: 1;
  }

  .online-empty-icon {
    font-size: 2rem;
  }

  /* Enhanced Responsive Design */
  @media (max-width: 575.98px) {
    .section-block {
      padding-block: 2rem;
    }
    
    .modern-card .card-body {
      padding: 1.5rem;
    }
    
    .modern-card .card-header,
    .modern-card .card-footer {
      padding: 1rem 1.5rem;
    }
    
    .container,
    .container-lg {
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    .section-title {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
    }
    
    .card:hover {
      transform: none;
    }
    
    .modern-card:hover {
      transform: none;
    }
  }

  @media (max-width: 767.98px) {
    .metric-icon {
      width: 44px;
      height: 44px;
      font-size: 1.25rem;
    }

    .metric-icon i {
      font-size: 1.25rem;
    }

    .avatar {
      width: 32px;
      height: 32px;
    }

    .avatar-lg {
      width: 72px;
      height: 72px;
    }

    .col-index {
      width: auto;
    }

    .online-empty-icon {
      font-size: 1.5rem;
    }
    
    .modern-card .card-body {
      padding: 1.75rem;
    }
    
    .section-block {
      padding-block: 2.5rem;
    }
  }

  @media (max-width: 991.98px) {
    .hero-shell {
      min-height: 280px;
    }
    
    .card:hover {
      transform: translateY(-2px);
    }
    
    .modern-card:hover {
      transform: translateY(-2px);
    }
  }

  @media (min-width: 768px) and (max-width: 991.98px) {
    .section-block {
      padding-block: 2.5rem;
    }
  }

  .activity-list li {
    position: relative;
    padding-left: 1.75rem;
    padding-bottom: 0.75rem;
    border-left: 2px solid #e2e8f0;
    margin-left: 0.5rem;
  }

  .activity-list li:last-child {
    border-left-color: transparent;
  }

  .activity-list li:before {
    content: "";
    position: absolute;
    left: -6px;
    top: 0.5rem;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--grad-success);
    box-shadow: 0 0 0 4px rgba(5, 150, 105, 0.15);
  }

  /* Utility */
  .text-gradient {
    background: var(--grad-accent);
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
  }

  .text-success {
    color: #059669 !important;
  }

  .text-primary {
    color: #2563eb !important;
  }

  .text-warning {
    color: #d97706 !important;
  }

  .text-danger {
    color: #dc2626 !important;
  }

  .text-info {
    color: #0284c7 !important;
  }

  /* Enhanced Focus States */
  .btn:focus-visible,
  .modern-card:focus-visible,
  a:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  /* Staggered Fade In Animation */
  .stagger-fade-in > * {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease-out forwards;
  }

  .stagger-fade-in > *:nth-child(1) { animation-delay: 0.1s; }
  .stagger-fade-in > *:nth-child(2) { animation-delay: 0.2s; }
  .stagger-fade-in > *:nth-child(3) { animation-delay: 0.3s; }
  .stagger-fade-in > *:nth-child(4) { animation-delay: 0.4s; }
  .stagger-fade-in > *:nth-child(5) { animation-delay: 0.5s; }
  .stagger-fade-in > *:nth-child(6) { animation-delay: 0.6s; }

  /* Chart Container Hover */
  .chart-container {
    transition: transform 0.3s ease;
  }

  .modern-card:hover .chart-container {
    transform: scale(1.02);
  }

  /* Quick Nav Enhanced Interactions */
  .quick-nav a {
    position: relative;
    overflow: hidden;
  }

  .quick-nav a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background: var(--primary);
    transform: translateX(-50%);
    transition: width 0.3s ease;
  }

  .quick-nav a:hover::after {
    width: 80%;
  }

  .quick-nav a.active::after {
    width: 80%;
  }

  /* Enhanced Buttons and Links Styling */
  .btn {
    font-weight: 600;
    letter-spacing: 0.3px;
    border-radius: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-size: 0.95rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
    position: relative;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-transform: none;
    cursor: pointer;
  }

  .btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .btn:hover::before {
    left: 100%;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .btn:active {
    transform: translateY(0);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .btn:focus-visible {
    outline: 3px solid rgba(5, 150, 105, 0.5);
    outline-offset: 2px;
  }

  /* Primary Button */
  .btn-primary {
    background: var(--gradient-primary);
    color: white;
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
  }

  .btn-primary:hover {
    background: linear-gradient(135deg, #047857 0%, #059669 100%);
    box-shadow: 0 8px 25px rgba(5, 150, 105, 0.4);
  }

  /* Success Button */
  .btn-success {
    background: var(--gradient-primary);
    color: white;
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
  }

  .btn-success:hover {
    background: linear-gradient(135deg, #047857 0%, #059669 100%);
    box-shadow: 0 8px 25px rgba(5, 150, 105, 0.4);
  }

  /* Outline Buttons */
  .btn-outline-primary {
    background: transparent;
    color: var(--primary);
    border: 2px solid var(--primary);
    position: relative;
  }

  .btn-outline-primary::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: var(--gradient-primary);
    transition: width 0.3s ease;
    z-index: -1;
  }

  .btn-outline-primary:hover::after {
    width: 100%;
  }

  .btn-outline-primary:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
  }

  .btn-outline-success {
    background: transparent;
    color: var(--success);
    border: 2px solid var(--success);
    position: relative;
  }

  .btn-outline-success::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: var(--gradient-primary);
    transition: width 0.3s ease;
    z-index: -1;
  }

  .btn-outline-success:hover::after {
    width: 100%;
  }

  .btn-outline-success:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
  }

  /* Small Buttons */
  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    font-weight: 600;
  }

  /* Links Enhancement */
  a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
  }

  a::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--gradient-primary);
    transition: width 0.3s ease;
  }

  a:hover {
    color: #047857;
  }

  a:hover::after {
    width: 100%;
  }

  /* Links with Icons */
  a i {
    transition: transform 0.3s ease;
  }

  a:hover i {
    transform: translateX(2px);
  }

  /* Button Groups */
  .btn-group .btn {
    border-radius: 0;
  }

  .btn-group .btn:first-child {
    border-top-left-radius: 0.5rem;
    border-bottom-left-radius: 0.5rem;
  }

  .btn-group .btn:last-child {
    border-top-right-radius: 0.5rem;
    border-bottom-right-radius: 0.5rem;
  }

  /* Pill Buttons */
  .btn.rounded-pill {
    border-radius: 2rem;
    padding: 0.5rem 1.25rem;
  }

  /* Icon Buttons */
  .btn-icon {
    width: 40px;
    height: 40px;
    padding: 0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn-icon.btn-sm {
    width: 32px;
    height: 32px;
  }

  /* Loading State */
  .btn.loading {
    pointer-events: none;
    opacity: 0.7;
  }

  .btn.loading::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    margin-left: 0.5rem;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Mobile Button Optimizations */
  @media (max-width: 768px) {
    .btn {
      padding: 0.625rem 1.25rem;
      font-size: 0.875rem;
    }

    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.8rem;
    }

    .btn.rounded-pill {
      padding: 0.375rem 1rem;
    }
  }

  @media (max-width: 576px) {
    .btn {
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      width: 100%;
      margin-bottom: 0.5rem;
    }

    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

    .btn-icon {
      width: 36px;
      height: 36px;
    }

    .btn-icon.btn-sm {
      width: 28px;
      height: 28px;
    }
  }

  /* Enhanced Link Cards */
  .link-card {
    display: block;
    padding: 1.5rem;
    background: white;
    border-radius: 12px;
    border: 2px solid #e5e7eb;
    text-decoration: none;
    color: var(--text-primary);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .link-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--gradient-primary);
    transform: translateY(-100%);
    transition: transform 0.3s ease;
  }

  .link-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
    border-color: var(--primary);
    color: var(--primary);
  }

  .link-card:hover::before {
    transform: translateY(0);
  }

  @media (max-width: 575.98px) {
    .hero-shell {
      min-height: auto;
    }

    .section-heading {
      font-size: 1.15rem;
    }
  }

  /* ================= Mobile Responsive Enhancements ================= */
  @media (max-width: 767.98px) {
    body {
      padding: 0;
      font-size: 14px;
    }

    .container,
    .container-lg {
      padding-left: 12px;
      padding-right: 12px;
    }

    /* Hero Section Mobile */
    .hero-shell {
      min-height: auto;
      border-radius: var(--radius);
    }

    .hero-shell .row {
      flex-direction: column;
    }

    .hero-img-wrap {
      min-height: 180px !important;
      max-height: 220px;
    }

    .glass-pane {
      padding: 16px !important;
      border-left: none;
      border-top: 1px solid var(--color-border);
    }

    .glass-pane h1.display-6 {
      font-size: 1.25rem;
    }

    .glass-pane .lead {
      font-size: 0.95rem;
    }

    .glass-pane .btn {
      padding: 8px 12px;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }

    /* Quick Nav Mobile */
    .quick-nav-wrapper {
      margin-top: -0.5rem;
      margin-bottom: 1rem;
      top: 56px;
    }

    .quick-nav {
      padding: 8px 10px;
      gap: 6px;
    }

    .quick-nav a {
      padding: 6px 10px;
      font-size: 0.75rem;
    }

    /* Section Blocks Mobile */
    .section-block {
      padding-block: 1.25rem;
    }

    .section-title {
      font-size: 1.1rem !important;
    }

    .section-title:after {
      width: 50px;
      height: 3px;
    }

    /* Cards Mobile */
    .modern-card {
      border-radius: 12px;
    }

    .modern-card .card-body {
      padding: 12px;
    }

    .modern-card .card-header {
      padding: 10px 12px;
      font-size: 0.9rem;
    }

    .card-title {
      font-size: 0.95rem;
    }

    .display-6 {
      font-size: 1.5rem !important;
    }

    /* Stats Cards Mobile */
    #stats .col-md-4 {
      margin-bottom: 12px;
    }

    #stats .card-body {
      padding: 12px;
    }

    #stats .card-title {
      font-size: 0.85rem;
      margin-bottom: 4px;
    }

    #stats .card-text.display-6 {
      font-size: 1.4rem !important;
      margin-bottom: 8px;
    }

    /* Enhanced Chart Responsive Design */
  .chart-container {
    position: relative;
    height: 300px;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
  }

  .chart-container:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  }

  .chart-container--sm {
    height: 250px;
    padding: 1rem;
  }

  .chart-container canvas {
    max-height: 100%;
    width: 100% !important;
  }

  /* Chart Section Styling */
  #charts .modern-card {
    overflow: hidden;
  }

  #charts .card-body {
    padding: 1.5rem;
  }

  #charts h4 {
    color: var(--primary);
    font-weight: 700;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  #charts h4 i {
    font-size: 1.25rem;
  }

  /* Chamra Chart Specific */
  #chamra-stage-chart .chart-container {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border: 2px solid var(--primary);
  }

  #chamra-stage-chart h4 {
    background: var(--gradient-primary);
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
  }

  /* Mobile Chart Optimizations */
  @media (max-width: 768px) {
    .chart-container {
      height: 250px !important;
      padding: 1rem;
    }

    .chart-container--sm {
      height: 200px !important;
      padding: 0.75rem;
    }

    #charts .card-body {
      padding: 1rem;
    }

    #charts h4 {
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }

    #charts h4 i {
      font-size: 1rem;
    }

    #charts .col-lg-8,
    #charts .col-lg-4 {
      margin-bottom: 1.5rem;
    }
  }

  @media (max-width: 576px) {
    .chart-container {
      height: 200px !important;
      padding: 0.75rem;
    }

    .chart-container--sm {
      height: 180px !important;
      padding: 0.5rem;
    }

    #charts .card-body {
      padding: 0.75rem;
    }

    #charts h4 {
      font-size: 1rem;
      margin-bottom: 0.75rem;
      flex-direction: column;
      text-align: center;
      gap: 0.25rem;
    }

    #charts h4 i {
      font-size: 0.875rem;
    }
  }

  /* Chart Loading State */
  .chart-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 300px;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    border: 1px solid #e5e7eb;
  }

  .chart-loading .spinner-border {
    width: 2rem;
    height: 2rem;
    border-color: var(--primary);
    border-right-color: transparent;
  }

  .chart-loading .text-muted {
    margin-left: 1rem;
    color: var(--text-secondary);
  }

  /* Chart Error State */
  .chart-error {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 300px;
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    border-radius: 12px;
    border: 1px solid #fecaca;
    color: #dc2626;
  }

  .chart-error i {
    font-size: 2rem;
    margin-right: 1rem;
  }

  /* Chart Empty State */
  .chart-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 300px;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    color: var(--text-secondary);
  }

  .chart-empty i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
    color: var(--primary);
  }

  .chart-empty p {
    font-size: 1rem;
    margin-bottom: 0;
  }

  /* Chart Responsive Grid */
  @media (max-width: 992px) {
    #charts .row {
      gap: 1.5rem;
    }
  }

  @media (max-width: 768px) {
    #charts .row {
      gap: 1rem;
    }
  }

  /* Enhanced Chart Animations */
  .chart-container {
    animation: fadeInUp 0.6s ease-out;
  }

  .chart-container:nth-child(1) {
    animation-delay: 0.1s;
  }

  .chart-container:nth-child(2) {
    animation-delay: 0.2s;
  }

  .chart-container:nth-child(3) {
    animation-delay: 0.3s;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Enhanced Table Responsive Design */
  .table-responsive {
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    background: #ffffff;
    border: 1px solid #e5e7eb;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .table {
    margin-bottom: 0;
    font-size: 0.95rem;
  }

  .table thead th {
    background: var(--gradient-primary);
    color: white;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
    padding: 1rem 0.75rem;
    border: none;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .table tbody tr {
    transition: all 0.2s ease;
    border-bottom: 1px solid #f3f4f6;
  }

  .table tbody tr:hover {
    background-color: var(--primary-light);
    transform: scale(1.01);
    box-shadow: 0 2px 8px rgba(5, 150, 105, 0.1);
  }

  .table tbody td {
    padding: 1rem 0.75rem;
    vertical-align: middle;
    border-bottom: 1px solid #f3f4f6;
  }

  .table tbody tr:last-child td {
    border-bottom: none;
  }

  /* Chamra Process Table Specific */
  #chamra-process .table {
    font-size: 0.9rem;
  }

  #chamra-process .table thead th {
    min-width: 80px;
    text-align: center;
  }

  #chamra-process .table thead th:first-child {
    min-width: 150px;
    text-align: left;
    position: sticky;
    left: 0;
    z-index: 11;
    background: var(--gradient-primary);
  }

  #chamra-process .table tbody td:first-child {
    position: sticky;
    left: 0;
    z-index: 5;
    background: white;
    font-weight: 600;
    border-right: 2px solid #e5e7eb;
  }

  #chamra-process .table tbody td:not(:first-child) {
    min-width: 80px;
    text-align: center;
  }

  #chamra-process .badge {
    font-size: 0.7rem;
    padding: 0.35rem 0.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
  }

  #chamra-process .badge.bg-success {
    background: var(--gradient-primary) !important;
    border: 1px solid var(--primary);
    color: white;
  }

  #chamra-process .badge.bg-secondary {
    background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%) !important;
    border: 1px solid #6b7280;
  }

  /* Mobile Table Optimizations */
  @media (max-width: 768px) {
    .table-responsive {
      font-size: 0.8rem;
      margin: 0 -1rem;
      padding: 0 1rem;
    }

    .table thead th {
      padding: 0.75rem 0.5rem;
      font-size: 0.75rem;
    }

    .table tbody td {
      padding: 0.75rem 0.5rem;
    }

    #chamra-process .table {
      font-size: 0.75rem;
    }

    #chamra-process .table thead th {
      min-width: 60px;
    }

    #chamra-process .table thead th:first-child {
      min-width: 100px;
    }

    #chamra-process .table tbody td:not(:first-child) {
      min-width: 60px;
    }

    #chamra-process .badge {
      font-size: 0.6rem;
      padding: 0.25rem 0.35rem;
    }

    #chamra-process .badge svg {
      width: 10px;
      height: 10px;
    }
  }

  @media (max-width: 576px) {
    .table-responsive {
      font-size: 0.75rem;
    }

    .table thead th {
      padding: 0.5rem 0.25rem;
      font-size: 0.7rem;
    }

    .table tbody td {
      padding: 0.5rem 0.25rem;
    }

    #chamra-process .table {
      font-size: 0.7rem;
    }

    #chamra-process .table thead th {
      min-width: 50px;
    }

    #chamra-process .table thead th:first-child {
      min-width: 80px;
    }

    #chamra-process .table tbody td:not(:first-child) {
      min-width: 50px;
    }

    #chamra-process .badge {
      font-size: 0.55rem;
      padding: 0.2rem 0.3rem;
    }
  }

  /* Table Empty State */
  .table-empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-secondary);
  }

  .table-empty-state i {
    font-size: 3rem;
    color: var(--primary);
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .table-empty-state p {
    font-size: 1rem;
    margin-bottom: 0;
  }

  /* Enhanced Table Footer */
  .table-footer-info {
    background: var(--primary-light);
    padding: 0.75rem 1rem;
    border-top: 1px solid var(--primary);
    font-size: 0.875rem;
    color: var(--text-secondary);
  }

  .table-footer-info i {
    color: var(--primary);
    margin-right: 0.5rem;
  }

    /* Groups Section Mobile */
    #groups .col-md-4 {
      margin-bottom: 10px;
    }

    #groups .badge {
      font-size: 0.75rem;
      padding: 6px 10px;
    }

    /* Featured Coops Mobile */
    #featured-coops .col-lg-4 {
      margin-bottom: 10px;
    }

    #featured-coops h6 {
      font-size: 0.85rem;
    }

    /* Members Section Mobile */
    #members .table {
      font-size: 0.75rem;
    }

    #members .table th,
    #members .table td {
      padding: 6px 8px;
    }

    /* Activities Section Mobile */
    #activitiesCalendar {
      min-height: 350px !important;
      font-size: 0.75rem;
    }

    #activitiesCalendar .fc-toolbar-title {
      font-size: 1rem !important;
    }

    #activitiesCalendar .fc-daygrid-day-number {
      font-size: 0.8rem;
    }

    #activitiesCalendar .fc-toolbar {
      gap: 6px;
      flex-wrap: wrap;
    }

    #activitiesCalendar .fc-button {
      padding: 0.2rem 0.55rem;
      font-size: 0.75rem;
    }

    /* Projects & Commands Mobile */
    #projects .col-md-6 {
      margin-bottom: 16px;
    }

    #projects .list-group-item {
      padding: 10px 8px;
      font-size: 0.85rem;
      flex-wrap: wrap;
    }

    #projects .badge {
      font-size: 0.7rem;
      margin-top: 4px;
    }

    /* Usecar Section Mobile */
    #usecar .col-md-6 {
      margin-bottom: 8px;
    }

    #usecar .list-group-item {
      padding: 10px;
    }

    #usecar .fw-bold {
      font-size: 0.9rem;
    }

    /* Online Section Mobile */
    #online .col-md-4,
    #online .col-md-8 {
      margin-bottom: 16px;
    }

    #online .display-4 {
      font-size: 2rem;
    }

    #online .col-md-4 .h4 {
      font-size: 1.1rem;
    }

    #online .col-md-6 img {
      width: 32px !important;
      height: 32px !important;
    }

    /* Modal Mobile */
    .modal-dialog {
      margin: 10px;
    }

    .modal-content {
      border-radius: 16px;
    }

    .modal-header {
      padding: 12px 16px;
    }

    .modal-body {
      padding: 16px;
    }

    .modal-title {
      font-size: 1rem;
    }

    /* Back to Top Mobile */
    .back-to-top {
      right: 12px;
      bottom: 12px;
      width: 40px;
      height: 40px;
    }

    /* Buttons Mobile */
    .btn {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 0.75rem;
    }

    /* Badge Mobile */
    .badge {
      font-size: 0.7rem;
    }

    /* Downloads Section Mobile */
    #downloads .table {
      font-size: 0.75rem;
    }

    /* Articles Section Mobile */
    #articles .card-body {
      padding: 10px;
    }

    /* Login Form Mobile */
    #loginFormCollapsible .form-label {
      font-size: 0.85rem;
    }

    #loginFormCollapsible .form-control {
      padding: 8px 12px;
      font-size: 0.9rem;
    }

    /* Row Gutters Mobile */
    .row.g-3 {
      --bs-gutter-x: 0.75rem;
      --bs-gutter-y: 0.75rem;
    }

    /* List Group Mobile */
    .list-group-item {
      padding: 10px 12px;
      font-size: 0.85rem;
    }

    /* Divider Mobile */
    .divider {
      margin: 1rem 0;
    }
  }

  /* Extra Small Devices (max-width: 375px) */
  @media (max-width: 375px) {
    body {
      font-size: 13px;
    }

    .hero-img-wrap {
      min-height: 150px !important;
    }

    .glass-pane {
      padding: 12px !important;
    }

    .quick-nav a {
      padding: 5px 8px;
      font-size: 0.7rem;
    }

    .display-6 {
      font-size: 1.25rem !important;
    }

    #stats .card-text.display-6 {
      font-size: 1.2rem !important;
    }

    .section-title {
      font-size: 1rem !important;
    }

    .chart-container {
      height: 240px !important;
    }

    .chart-container--sm {
      height: 200px !important;
    }

    #activitiesCalendar {
      min-height: 300px !important;
    }
  }

  /* Enhanced Colors and Visual Hierarchy */
  .section-title {
    position: relative;
    padding-bottom: 1rem;
    color: var(--primary);
    font-weight: 700;
  }

  .section-title:after {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 0;
    width: 80px;
    height: 4px;
    background: var(--gradient-primary);
    border-radius: 4px;
  }

  /* Enhanced Card Headers */
  .modern-card .card-header {
    background: linear-gradient(135deg, var(--primary-light) 0%, #f0fdf4 100%);
    border-bottom: 2px solid var(--primary);
    font-weight: 600;
    color: var(--primary);
  }

  .modern-card .card-header h5 {
    margin: 0;
    font-size: 1.1rem;
  }

  /* Icon Colors */
  .text-primary i,
  .bi.text-primary {
    color: var(--primary) !important;
  }

  .text-success i,
  .bi.text-success {
    color: var(--success) !important;
  }

  .text-warning i,
  .bi.text-warning {
    color: var(--warning) !important;
  }

  .text-danger i,
  .bi.text-danger {
    color: var(--danger) !important;
  }

  .text-info i,
  .bi.text-info {
    color: var(--info) !important;
  }

  /* Enhanced Badges */
  .badge.bg-success {
    background: var(--gradient-primary) !important;
    border: 1px solid var(--primary);
  }

  .badge.bg-primary {
    background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%) !important;
    border: 1px solid #2563eb;
  }

  .badge.bg-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%) !important;
    border: 1px solid #f59e0b;
    color: #78350f !important;
  }

  .badge.bg-danger {
    background: linear-gradient(135deg, #ef4444 0%, #f87171 100%) !important;
    border: 1px solid #ef4444;
  }

  .badge.bg-info {
    background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%) !important;
    border: 1px solid #3b82f6;
  }

  .badge.bg-secondary {
    background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%) !important;
    border: 1px solid #6b7280;
  }

  /* Enhanced Table Headers */
  .table-dark {
    background: var(--gradient-primary) !important;
  }

  .table-dark th {
    border-color: rgba(255, 255, 255, 0.1) !important;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
  }

  /* Enhanced Buttons */
  .btn-primary {
    background: var(--gradient-primary);
    border: none;
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
    transition: all 0.3s ease;
  }

  .btn-primary:hover {
    background: linear-gradient(135deg, #047857 0%, #059669 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
  }

  .btn-success {
    background: var(--gradient-primary);
    border: none;
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
  }

  .btn-success:hover {
    background: linear-gradient(135deg, #047857 0%, #059669 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
  }

  .btn-outline-primary {
    border: 2px solid var(--primary);
    color: var(--primary);
    background: transparent;
    transition: all 0.3s ease;
  }

  .btn-outline-primary:hover {
    background: var(--gradient-primary);
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
  }

  .btn-outline-success {
    border: 2px solid var(--success);
    color: var(--success);
    background: transparent;
    transition: all 0.3s ease;
  }

  .btn-outline-success:hover {
    background: var(--gradient-primary);
    border-color: var(--success);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
  }

  /* Section Backgrounds */
  .section-block.bg-light {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }

  .section-block.bg-white {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  }

  /* Enhanced Links */
  a {
    color: var(--primary);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  a:hover {
    color: #047857;
    text-decoration: underline;
  }

  /* Enhanced Stats Display */
  .display-4 {
    background: var(--gradient-primary);
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
    font-weight: 800;
  }

  /* Enhanced Chart Containers */
  .chart-container {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  }

  /* Back to Top Button */
  .back-to-top {
    position: fixed;
    right: 1.5rem;
    bottom: 1.5rem;
    z-index: 1040;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: var(--grad-accent);
    color: #fff;
    box-shadow: 0 8px 24px -6px rgba(37, 99, 235, .4);
    border: 0;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
    cursor: pointer;
  }

  .back-to-top:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: 0 12px 32px -8px rgba(37, 99, 235, .5);
  }

  .back-to-top.show {
    opacity: 1;
    visibility: visible;
  }

  .back-to-top:focus-visible {
    outline: 3px solid #fff;
    outline-offset: 3px;
  }

  .back-to-top i {
    font-size: 1.25rem;
  }

  /* Badges */
  .badge {
    letter-spacing: 0.3px;
    font-weight: 500;
    padding: 0.4rem 0.75rem;
    border-radius: 2rem;
  }

  .hp-badge {
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
  }

  /* === Enhanced Modal Styling === */
  .modal-elevated .modal-content {
    border: 0;
    border-radius: 1.5rem;
    box-shadow: 0 25px 60px -15px rgba(0, 0, 0, .35);
    overflow: hidden;
  }

  .modal-gradient {
    background: var(--grad-accent);
    color: #fff;
    padding: 1.25rem 1.5rem;
  }

  .modal-gradient .modal-title {
    font-weight: 600;
    font-size: 1.1rem;
  }

  .modal-gradient .btn-close {
    filter: invert(1) contrast(200%);
    opacity: 0.85;
  }

  .modal-gradient .btn-close:hover {
    opacity: 1;
  }

  .modal-body {
    background: #f8fafc;
    padding: 1.5rem;
  }

  .modal-section-divider {
    height: 1px;
    background: rgba(255, 255, 255, .15);
    margin: .35rem 0 0;
  }

  /* Tables */
  .table-modern thead th {
    position: sticky;
    top: 0;
    background: #fff;
    z-index: 5;
    font-weight: 600;
    box-shadow: 0 2px 0 0 #e2e8f0;
    padding: 1rem 0.75rem;
  }

  .table-modern tbody tr {
    transition: .25s;
  }

  .table-modern tbody tr:hover {
    background: #f1f5f9;
  }

  /* Loading */
  .loading-fade {
    animation: fadePulse 1.6s ease-in-out infinite;
  }

  @keyframes fadePulse {

    0%,
    100% {
      opacity: .35;
    }

    50% {
      opacity: 1;
    }
  }

  .badge-soft {
    background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
    color: #0369a1;
    border: 1px solid #bae6fd;
  }

  .modal-search-bar {
    border-radius: 50px;
    padding: 0.65rem 1.25rem;
    border: 2px solid #e2e8f0;
    background: #fff;
    transition: var(--transition-fast);
  }

  .modal-search-bar:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
    outline: none;
  }

  .fade-in-row {
    animation: fadeInUp .45s cubic-bezier(.4, .8, .2, 1);
  }

  /* List Group Enhancement */
  .list-group-item {
    border: 0;
    border-bottom: 1px solid #f1f5f9;
    padding: 1rem 1.25rem;
    transition: var(--transition-fast);
  }

  .list-group-item:last-child {
    border-bottom: 0;
  }

  .list-group-item:hover {
    background: #f8fafc;
  }

  /* Chart sizing to prevent stretching */
  .chart-container {
    position: relative;
    height: 300px;
  }

  .chart-container--sm {
    height: 250px;
  }

  @media (max-width: 575.98px) {
    .chart-container {
      height: 240px;
    }

    .chart-container--sm {
      height: 200px;
    }
  }

  /* Calendar sizing */
  #activitiesCalendar {
    min-height: 520px;
    border-radius: var(--radius);
    background: #f8fafc;
    overflow: hidden;
  }

  #activitiesCalendar .fc {
    background: #ffffff;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  #activitiesCalendar .fc .fc-scrollgrid {
    background: #f8fafc;
  }

  #activitiesCalendar .fc .fc-toolbar {
    padding: 0.75rem 1rem;
    background: linear-gradient(90deg, #eff6ff 0%, #ffffff 60%);
    border-bottom: 1px solid var(--color-border);
  }

  #activitiesCalendar .fc .fc-toolbar-title {
    font-weight: 700;
    color: #0f172a;
  }

  #activitiesCalendar .fc .fc-button {
    background: #ffffff;
    border: 1px solid #cbd5e1;
    color: #0f172a;
    border-radius: 999px;
    box-shadow: none;
    padding: 0.25rem 0.7rem;
    font-weight: 600;
  }

  #activitiesCalendar .fc .fc-button:hover {
    background: #e2e8f0;
  }

  #activitiesCalendar .fc .fc-button-primary:not(:disabled).fc-button-active {
    background: #2563eb;
    border-color: #2563eb;
    color: #ffffff;
  }

  #activitiesCalendar .fc-daygrid-day-number {
    color: #334155;
    font-weight: 600;
  }

  #activitiesCalendar .fc-daygrid-day {
    background: #ffffff;
  }

  #activitiesCalendar .fc-day-today {
    background: #eff6ff;
  }

  #activitiesCalendar .fc-daygrid-day-frame {
    padding: 6px;
  }

  #activitiesCalendar .fc-event {
    border: 0;
    background: #10b981;
    color: #ffffff;
    border-radius: 10px;
    padding: 2px 6px;
    font-size: 0.75rem;
    box-shadow: 0 4px 10px rgba(16, 185, 129, 0.2);
  }

  #activitiesCalendar .fc-event:hover {
    filter: brightness(0.96);
  }

  #activitiesCalendar .fc-daygrid-more-link {
    color: #2563eb;
    font-weight: 600;
  }

  /* Stats Cards */
  #stats .card {
    text-align: center;
    transition: var(--transition);
  }

  #stats .card:hover {
    transform: translateY(-8px);
  }

  #stats .card-title {
    color: #64748b;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }

  #stats .display-6 {
    font-weight: 700;
    margin-bottom: 0.75rem;
  }

  /* Form Controls */
  .form-control {
    border-radius: 0.75rem;
    border: 2px solid #e2e8f0;
    padding: 0.75rem 1rem;
    transition: var(--transition-fast);
  }

  .form-control:focus {
    border-color: #059669;
    box-shadow: 0 0 0 4px rgba(5, 150, 105, 0.1);
  }

  .form-label {
    font-weight: 500;
    color: #475569;
    margin-bottom: 0.5rem;
  }

  /* Login Form */
  .login-form-wrapper {
    padding: 1rem;
  }

  .login-form-wrapper h5 {
    color: #1e293b;
    font-weight: 600;
    margin-bottom: 1.5rem;
  }

  /* Meeting room today */
  .meeting-today-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, .92), rgba(255, 255, 255, .82));
    border: 1px solid rgba(15, 23, 42, 0.08);
    border-radius: 18px;
    box-shadow: 0 16px 40px rgba(15, 23, 42, 0.10);
    overflow: hidden;
  }

  .meeting-today-head {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(15, 23, 42, 0.06);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    background:
      radial-gradient(1200px 200px at 10% 0%, rgba(99, 102, 241, .18), transparent 55%),
      radial-gradient(900px 260px at 100% 20%, rgba(16, 185, 129, .12), transparent 55%);
  }

  .meeting-today-title {
    font-weight: 800;
    letter-spacing: .2px;
    margin: 0;
    color: #0f172a;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .meeting-today-title .badge {
    font-weight: 700;
    border-radius: 999px;
    padding: 6px 10px;
    background: rgba(99, 102, 241, .12);
    color: #3730a3;
    border: 1px solid rgba(99, 102, 241, .18);
  }

  .meeting-today-body {
    padding: 12px 16px 14px;
  }

  .meeting-today-empty {
    padding: 12px 14px;
    background: rgba(15, 23, 42, 0.03);
    border: 1px dashed rgba(15, 23, 42, 0.18);
    border-radius: 14px;
    color: #334155;
  }

  .meeting-today-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: 10px;
  }

  .meeting-today-item {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 12px;
    align-items: start;
    padding: 12px;
    border: 1px solid rgba(15, 23, 42, 0.08);
    border-radius: 14px;
    background: rgba(255, 255, 255, .86);
  }

  .meeting-meta {
    display: grid;
    gap: 8px;
    font-size: .92rem;
    color: #334155;
  }

  .meeting-meta .pill {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    padding: 6px 10px;
    font-weight: 800;
    background: rgba(16, 185, 129, .10);
    border: 1px solid rgba(16, 185, 129, .16);
    color: #065f46;
    width: fit-content;
  }

  .meeting-meta .time {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #0f172a;
    font-weight: 800;
  }

  .meeting-subject {
    font-weight: 900;
    color: #0f172a;
    line-height: 1.25;
    margin: 0;
  }

  .meeting-subline {
    margin-top: 6px;
    color: #475569;
    font-size: .92rem;
  }

  @media (max-width: 767.98px) {
    .meeting-today-item {
      grid-template-columns: 1fr;
    }

    .meeting-meta {
      grid-auto-flow: column;
      grid-auto-columns: max-content;
      align-items: center;
    }
  }

  /* Meeting deadlines */
  .deadline-card {
    border: 1px solid var(--color-border);
  }

  .deadline-group {
    border-top: 1px solid var(--color-border);
    padding: 0.75rem 1rem 0.25rem;
    background: #f8f9fa;
  }

  .deadline-group:first-of-type {
    border-top: 0;
  }

  .deadline-group .badge {
    font-weight: 600;
    padding: 0.35rem 0.6rem;
    border-radius: 999px;
  }

  .deadline-table thead th {
    font-weight: 600;
    color: #495057;
  }

  .deadline-name {
    font-weight: 600;
  }

  .deadline-code {
    color: #6c757d;
    font-size: 0.85rem;
  }

  .deadline-date {
    font-weight: 600;
    color: #0d6efd;
  }
</style>



<!-- Added: Light theme & contrast fixes -->
<style>
  /* Force light theme to avoid unreadable dark auto-scheme */
  @media (prefers-color-scheme: dark) {
    :root {
      --color-bg: #f8fafc !important;
      --color-surface: #ffffff !important;
      --color-text: #1e293b !important;
      --color-border: #e2e8f0 !important;
    }

    body {
      background: #f8fafc !important;
      color: #1e293b !important;
    }
  }

  body {
    background: #f8fafc !important;
    color: #1e293b !important;
  }

  /* Ensure primary containers stay light */
  .hero-shell {
    background: var(--color-accent-grad) !important;
  }

  .modern-card,
  .quick-nav,
  .card,
  .table thead th,
  .table tbody td {
    background: #ffffff !important;
  }

  /* Text visibility */
  .text-dark,
  .card .text-dark,
  .table,
  .table td,
  .table th {
    color: #1e293b !important;
  }

  /* Table borders / striping */
  .table-bordered> :not(caption)>* {
    border-color: #e2e8f0 !important;
  }

  .table thead th {
    background: #f8fafc !important;
    font-weight: 600;
    color: #475569 !important;
  }

  .table-striped>tbody>tr:nth-of-type(odd) {
    --bs-table-accent-bg: #f8fafc;
    background: #f8fafc;
  }

  /* Chamra status badges readability */
  .hp-badge {
    font-size: 0.7rem;
    letter-spacing: 0.3px;
  }

  /* Badges general contrast */
  .badge.bg-secondary {
    background: #64748b !important;
  }

  .badge.bg-success {
    background: #059669 !important;
  }

  .badge.bg-info {
    background: #0284c7 !important;
  }

  .badge.bg-warning {
    background: #d97706 !important;
    color: #fff !important;
  }

  .badge.bg-danger {
    background: #dc2626 !important;
  }

  .badge.bg-primary {
    background: #2563eb !important;
  }

  /* Quick nav active clarity */
  .quick-nav a {
    color: #475569 !important;
  }

  .quick-nav a.active {
    color: #fff !important;
  }

  /* Remove any accidental dark backgrounds from Bootstrap utilities */
  [class*="bg-dark"] {
    background: #1e293b !important;
  }
</style>

<%
// Helper: map backend c_group codes to readable Thai names
function displayGroupName(code){
  switch(code){
    case 'group1': return 'กลุ่มส่งเสริมสหกรณ์ 1';
    case 'group2': return 'กลุ่มส่งเสริมสหกรณ์ 2';
    case 'group3': return 'กลุ่มส่งเสริมสหกรณ์ 3';
    case 'group4': return 'กลุ่มส่งเสริมสหกรณ์ 4';
    case 'group5': return 'กลุ่มส่งเสริมสหกรณ์ 5';
    default: return code || '-';
  }
}

// Meeting room locals (safe defaults in case some controller doesn't pass them)
const _meetingsToday = (typeof meetingsToday !== 'undefined' && Array.isArray(meetingsToday)) ? meetingsToday : [];
const _meetingroomTodayDate = (typeof meetingroomTodayDate !== 'undefined' && meetingroomTodayDate) ? meetingroomTodayDate : '';
const _coopTypeByGroup = (typeof coopTypeByGroup !== 'undefined' && Array.isArray(coopTypeByGroup)) ? coopTypeByGroup : [];
const _coopTypeSummary = (typeof coopTypeSummary !== 'undefined' && coopTypeSummary) ? coopTypeSummary : null;
const _strengthTypeGrades = (typeof strengthTypeGrades !== 'undefined' && Array.isArray(strengthTypeGrades)) ? strengthTypeGrades : [];
const _strengthTypeRows = (typeof strengthTypeRows !== 'undefined' && Array.isArray(strengthTypeRows)) ? strengthTypeRows : [];
const _strengthTypeYear = (typeof strengthTypeYear !== 'undefined' && strengthTypeYear) ? strengthTypeYear : '';
const _gradeSummary = (typeof gradeSummary !== 'undefined' && Array.isArray(gradeSummary)) ? gradeSummary : [];
const _summaryYear = (typeof summaryYear !== 'undefined' && summaryYear) ? summaryYear : (typeof _strengthTypeYear !== 'undefined' ? _strengthTypeYear : '-');
const _latestYear = (typeof latestYear !== 'undefined' && latestYear) ? latestYear : '-';
const _memberSummary = (typeof memberSummary !== 'undefined' && memberSummary) ? memberSummary : {};
%>

<!-- ================= Hero ================= -->
<div class="container my-3 mb-4 reveal in" id="top">
  <div class="hero-shell">
    <div class="row g-0 h-100 align-items-stretch">

      <div class="col-md-6 hero-img-wrap p-0 position-relative h-100">
        <img src="/images/banner.png" alt="Coop Image" class="w-100 h-100 object-fit-cover d-block" decoding="async" fetchpriority="high" />
      </div>
      <div class="col-md-6 glass-pane d-flex align-items-center p-4 h-100">
        <% if (!user) { %>
        <div class="w-100">

          <!-- Small screen toggle button (hidden on sm and up) -->
          <button type="button" id="showLoginBtn" class="btn btn-success w-100 d-sm-none py-3" aria-expanded="false" aria-controls="loginFormCollapsible">
            <i class="bi bi-box-arrow-in-right me-2"></i> เข้าระบบ
          </button>

          <!-- Wrapper gains d-none only on extra-small; visible on sm+ -->
          <div id="loginFormCollapsible" class="login-form-wrapper d-none d-sm-block">
            <h5 class="text-center mb-4 d-none d-sm-block">
              <i class="bi bi-shield-lock me-2 text-success"></i>เข้าระบบ
            </h5>
            <form action="/auth/login" method="POST">
              <div class="mb-3">
                <label for="username" class="form-label">
                  <i class="bi bi-person me-1"></i> ชื่อผู้ใช้งาน
                </label>
                <input type="text" class="form-control" id="username" name="username" placeholder="กรอกชื่อผู้ใช้งาน" required />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">
                  <i class="bi bi-key me-1"></i> รหัสผ่าน
                </label>
                <input type="password" class="form-control" id="password" name="password" placeholder="กรอกรหัสผ่าน" required />
              </div>
              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="rememberMe" name="rememberMe">
                <label for="rememberMe" class="form-check-label">จดจำฉัน</label>
              </div>
              <div class="d-grid mb-3">
                <button type="submit" class="btn btn-success btn-lg">
                  <i class="bi bi-box-arrow-in-right me-2"></i>เข้าระบบ
                </button>
              </div>
            </form>

            <p class="text-center text-muted mb-0">
              <i class="bi bi-person-plus me-1"></i> ยังไม่มีบัญชี?
              <a href="/auth/register" class="text-success fw-semibold">สมัครสมาชิก</a>
            </p>
          </div>
        </div>
        <script>
          (function() {
            const btn = document.getElementById('showLoginBtn');
            const wrap = document.getElementById('loginFormCollapsible');
            if (!btn || !wrap) return;

            function toggle() {
              const isHidden = wrap.classList.contains('d-none');
              if (isHidden) {
                wrap.classList.remove('d-none');
                btn.setAttribute('aria-expanded', 'true');
                btn.innerHTML = '<i class="bi bi-chevron-up me-2"></i> ซ่อนแบบฟอร์ม';
              } else {
                wrap.classList.add('d-none');
                btn.setAttribute('aria-expanded', 'false');
                btn.innerHTML = '<i class="bi bi-box-arrow-in-right me-2"></i> เข้าระบบ';
              }
            }
            btn.addEventListener('click', toggle);
          })();
        </script>
        <% } else { %>
        <div class="w-100 text-center py-3">
          <h1 class="display-6 mb-3 text-success fw-bold">
            <i class="bi bi-emoji-smile me-2"></i>ยินดีต้อนรับ!
          </h1>
          <img src="<%= user.m_img %>" alt="User Image" class="rounded-circle mb-3 shadow avatar-lg" width="100" height="100" loading="lazy" decoding="async">
          <p class="lead mb-4 fw-semibold">
            <%= user.fullname %>
          </p>
          <div class="d-flex flex-wrap justify-content-center gap-2">
            <a href="/dashboard" class="btn btn-success">
              <i class="bi bi-speedometer2 me-1"></i> แดชบอร์ด
            </a>
            <% if(user && (user.mClass==='kjs' || user.mClass==='admin')) { %>

            <a href="/chamra" class="btn btn-outline-secondary">
              <i class="bi bi-file-earmark-check me-1"></i> ชำระบัญชี
            </a>
            <% } %>
            <a href="/auth/logout" class="btn btn-outline-danger">
              <i class="bi bi-box-arrow-right me-1"></i> ออกจากระบบ
            </a>
          </div>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<!-- vong_coop link -->
<div class="container mb-4 reveal in">
  <div class="row my-2">
    <div class="col-md-6 mb-2 mb-md-0">
      <a href="/uploads/pdf/vong_coop.pdf" target="_blank" rel="noopener" class="d-inline-flex align-items-center gap-2 btn btn-primary btn-lg w-100">
        <i class="bi bi-globe2"></i>
        <span class="text-wrap" style="font-size: 16px;">
        หลักเกณฑ์การกำหนดวงเงินกู้ยืม[กลุ่มเกษตรกร]
        </span>
      </a>
    </div>
    <div class="col-md-6">
      <a href="/uploads/pdf/vong_group.pdf" target="_blank" rel="noopener" class="d-inline-flex align-items-center gap-2 btn btn-secondary btn-lg w-100">
        <i class="bi bi-globe2"></i>
        <span class="text-wrap" style="font-size: 16px;">
        หลักเกณฑ์การกำหนดวงเงินดำเนินกิจการ[กลุ่มเกษตรกร]
        </span>
      </a>
    </div>
  </div>
</div>

<!-- ================= Meeting Room Today With Link ================= -->
<div class="container mb-4 reveal in">
  <div class="meeting-today-card">
    <div class="meeting-today-head">
      <h3 class="meeting-today-title">
        <span class="badge">วันนี้</span>
        การใช้ห้องประชุม
      </h3>
      <div class="d-flex align-items-center gap-3">
        <div class="text-muted small d-none d-sm-block">
          <% 
            let _thMeetingDate = _meetingroomTodayDate;
            if (_thMeetingDate) {
              const parts = _thMeetingDate.split('-');
              if (parts.length === 3) {
                const thMonths = [
                  "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน",
                  "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
                ];
                const y = parseInt(parts[0]) + 543;
                const m = parseInt(parts[1]) - 1;
                const d = parseInt(parts[2]);
                if (!isNaN(y) && !isNaN(m) && !isNaN(d) && thMonths[m]) {
                   _thMeetingDate = `${d} ${thMonths[m]} ${y}`;
                }
              }
            }
          %>
          <%= _thMeetingDate %>
        </div>
        <a href="/meetingroom" class="btn btn-sm btn-outline-primary rounded-pill d-inline-flex align-items-center gap-1" style="font-weight: 600; font-size: 0.85rem;">
          <i class="bi bi-calendar-event"></i>
          ดูทั้งหมด
        </a>
      </div>
    </div>
    <div class="meeting-today-body">
      <% if (_meetingsToday.length) { %>
      <ul class="meeting-today-list">
        <% _meetingsToday.forEach(function(m){ %>
        <li class="meeting-today-item">
          <div class="meeting-meta">
            <div class="pill"><%= m.mee_room || '-' %></div>
            <div class="time">⏱ <%= m.mee_time || '-' %></div>
          </div>
          <div>
            <p class="meeting-subject"><%= m.mee_subject || '-' %></p>
            <% if (m.mee_respon) { %>
            <div class="meeting-subline">ผู้รับผิดชอบ: <%= m.mee_respon %></div>
            <% } %>
          </div>
        </li>
        <% }); %>
      </ul>
      <% } else { %>
      <div class="meeting-today-empty">วันนี้ยังไม่มีรายการใช้ห้องประชุม</div>
      <% } %>
    </div>
  </div>
</div>






<section>
<% // Precompute chamra stage counts once (S1..S10)
  let __chamraCounts = null;
  if ((chamraAllProcesses||[]).length) {
    __chamraCounts = {};
    for (let i=1;i<=10;i++) __chamraCounts['S'+i] = 0;
    const __isEmptyChamra = (v) => {
      if (!v) return true;
      if (typeof v === 'string') {
        if (v === '0000-00-00') return true;
        if (/^1899-11-30/.test(v)) return true;
      }
      const d = new Date(v);
      return isNaN(d.getTime()) || d.getFullYear() < 1950;
    };
    // Count by highest achieved stage only, using all records from chamra_process
    (chamraAllProcesses||[]).forEach(p => {
      for (let i=10;i>=1;i--) {
        const raw = p['pr_s'+i];
        if (!__isEmptyChamra(raw)) { __chamraCounts['S'+i]++; break; }
      }
    });
  }
%>


<!-- ================= Stats ================= -->
<section id="stats" class="section-block pt-4">
  <div class="container">
   
    <h2 class="my-4 text-center text-primary section-title">
      <i class="bi bi-bar-chart-line-fill me-2"></i> ข้อมูลสหกรณ์
    </h2>
    <div class="row g-4 mt-2">
      <div class="col-md-4">
        <div class="card modern-card shadow-sm border-0 h-100">
          <div class="card-gradient-bar" style="background: var(--grad-success);"></div>
          <div class="card-body text-center py-4">
            <div class="mb-3">
              <span class="d-inline-flex align-items-center justify-content-center rounded-circle bg-success bg-opacity-10 metric-icon">
                <i class="bi bi-building text-success"></i>
              </span>
            </div>
            <h5 class="card-title text-muted mb-2">จำนวนสหกรณ์</h5>
            <p class="card-text display-5 text-success fw-bold mb-3">
              <%= stats.coop %>
            </p>
            <span class="badge bg-success bg-opacity-10 text-white mb-3">แห่ง</span>
            <div class="mt-2">
              <a class="btn btn-sm btn-outline-success rounded-pill" href="/allCoop/group">
                <i class="bi bi-arrow-right-circle me-1"></i> รายละเอียด
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card modern-card shadow-sm border-0 h-100">
          <div class="card-gradient-bar" style="background: linear-gradient(135deg, #0284c7 0%, #06b6d4 100%);"></div>
          <div class="card-body text-center py-4">
            <div class="mb-3">
              <span class="d-inline-flex align-items-center justify-content-center rounded-circle bg-info bg-opacity-10 metric-icon">
                <i class="bi bi-people-fill text-info"></i>
              </span>
            </div>
            <h5 class="card-title text-muted mb-2">จำนวนกลุ่มเกษตรกร</h5>
            <p class="card-text display-5 text-info fw-bold mb-3">
              <%= stats.farmer %>
            </p>
            <span class="badge bg-info bg-opacity-10 text-info mb-3">แห่ง</span>
            <div class="mt-2">
              <a class="btn btn-sm btn-outline-info rounded-pill" href="/allCoop/group">
                <i class="bi bi-arrow-right-circle me-1"></i> รายละเอียด
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card modern-card shadow-sm border-0 h-100">
          <div class="card-gradient-bar" style="background: var(--grad-warm);"></div>
          <div class="card-body text-center py-4">
            <div class="mb-3">
              <span class="d-inline-flex align-items-center justify-content-center rounded-circle bg-warning bg-opacity-10 metric-icon">
                <i class="bi bi-hourglass-split text-warning"></i>
              </span>
            </div>
            <h5 class="card-title text-muted mb-2">อยู่ระหว่างชำระบัญชี</h5>
            <p class="card-text display-5 text-warning fw-bold mb-3">
              <%= stats.closing %>
            </p>
            <span class="badge bg-warning bg-opacity-10 text-warning mb-3">แห่ง</span>
            <div class="mt-2">
              <a class="btn btn-sm btn-outline-warning rounded-pill" href="/chamra">
                <i class="bi bi-arrow-right-circle me-1"></i> รายละเอียด
              </a>
            </div>
        </div>
      </div>
    </div>
  </section>

 




  <!-- ================= Charts ================= -->
  <section id="charts" class="section-block">
    <div class="container-lg">
      <div class="row g-4 justify-content-center">
        <div class="col-lg-8">
          <div class="card modern-card shadow-sm border-0">
            <div class="card-gradient-bar"></div>
            <div class="card-body p-4">
              <h4 class="mb-4 text-center text-primary fw-semibold">
                <i class="bi bi-bar-chart-fill me-2"></i> กราฟแสดงจำนวนสหกรณ์/กลุ่มเกษตรกร
              </h4>
              <div class="chart-container">
                <canvas id="coopChart" height="120"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card modern-card shadow-sm border-0 h-100">
            <div class="card-gradient-bar"></div>
            <div class="card-body p-4">
              <h4 class="mb-4 text-center text-primary fw-semibold">
                <i class="bi bi-pie-chart-fill me-2"></i> สัดส่วน
              </h4>
              <div class="chart-container chart-container--sm d-flex justify-content-center">
                <canvas id="coopPieChart" height="120"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <section>
    <div class="container">
       <div class="card modern-card shadow-sm border-0 mb-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
        <h5 class="mb-0">
          <i class="bi bi-people me-2 text-primary"></i>สรุปจำนวนสถาบันตามประเภท
        </h5>
        <span class="small text-muted">ฐานข้อมูล active_coop</span>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm table-hover mb-0 deadline-table">
            <thead class="table-light">
              <tr>
                <th>กลุ่มส่งเสริม</th>
                <th class="text-end">สหกรณ์ภาคการเกษตร</th>
                <th class="text-end">สหกรณ์นอกภาคการเกษตร</th>
                <th class="text-end">กลุ่มเกษตรกร</th>
                <th class="text-end">รวม</th>
              </tr>
            </thead>
            <tbody>
              <% if ((_coopTypeByGroup || []).length) { %>
              <% _coopTypeByGroup.forEach((row) => { %>
              <tr>
                <td><%= displayGroupName(row.c_group) %></td>
                <td class="text-end"><%= Number(row.coop_agri || 0).toLocaleString() %></td>
                <td class="text-end"><%= Number(row.coop_non_agri || 0).toLocaleString() %></td>
                <td class="text-end"><%= Number(row.farmer_group || 0).toLocaleString() %></td>
                <td class="text-end fw-bold"><%= Number((row.coop_agri || 0) + (row.coop_non_agri || 0) + (row.farmer_group || 0)).toLocaleString() %></td>
              </tr>
              <% }) %>
              <% } else { %>
              <tr>
                <td colspan="4" class="text-center text-muted py-3">ไม่มีข้อมูล</td>
              </tr>
              <% } %>
            </tbody>
            <tfoot class="table-light">
              <tr>
                <th>รวมทั้งหมด</th>
                <th class="text-end"><%= Number((_coopTypeSummary && _coopTypeSummary.coop_agri) || 0).toLocaleString() %></th>
                <th class="text-end"><%= Number((_coopTypeSummary && _coopTypeSummary.coop_non_agri) || 0).toLocaleString() %></th>
                <th class="text-end"><%= Number((_coopTypeSummary && _coopTypeSummary.farmer_group) || 0).toLocaleString() %></th>
                <th class="text-end fw-bold"><%= Number((Number(_coopTypeSummary?.coop_agri || 0) + Number(_coopTypeSummary?.coop_non_agri || 0) + Number(_coopTypeSummary?.farmer_group || 0))).toLocaleString() %></th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
    </div>
  </section>

  <!-- ================= Coop Group Counts ================= -->
  <section id="coop-groups" class="section-block bg-light">
    <div class="container">
      <h2 class="my-4 text-center text-primary section-title">
        <i class="bi bi-people-fill me-2"></i> สรุปจำนวนตามกลุ่มส่งเสริมสหกรณ์
      </h2>
      <% if ((coopGroupStats || []).length) { %>
      <div class="row g-3">
        <% (coopGroupStats || []).forEach((g) => { %>
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card modern-card shadow-sm border-0 h-100">
            <div class="card-body">
              <h6 class="text-primary fw-semibold mb-2">
                <i class="bi bi-diagram-3 me-1"></i>
                <%= displayGroupName(g.c_group) %>
              </h6>
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted">สหกรณ์</span>
                <span class="fw-bold text-success"><%= Number(g.coop || 0) %> แห่ง</span>
              </div>
              <div class="d-flex justify-content-between align-items-center mt-1">
                <span class="text-muted">กลุ่มเกษตรกร</span>
                <span class="fw-bold text-info"><%= Number(g.farmer || 0) %> แห่ง</span>
              </div>
              <% if (g.c_group) { %>
              <div class="mt-3 text-end">
                <a href="/allcoop/group/<%= g.c_group %>" class="btn btn-outline-primary btn-sm">
                  ดูข้อมูล
                </a>
              </div>
              <% } %>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
      <% } else { %>
      <div class="alert alert-light border text-center">ไม่มีข้อมูล</div>
      <% } %>
    </div>
     
  </section>


  <!-- ================= Chamra Stages Chart ================= -->
  <section class="section-block bg-light">
    <div class="container">
      <div class="card modern-card shadow-sm border-0">
        <div class="card-gradient-bar"></div>
        <div class="card-body p-4">
          <h4 class="mb-4 text-center text-primary fw-semibold">
            <i class="bi bi-bar-chart-steps me-2"></i> กราฟขั้นตอนการชำระบัญชี (S1-S10)
          </h4>
          <div class="chart-container">
            <canvas id="chamraStageChart" height="120"></canvas>
          </div>
        </div>
      </div>
    </div>
  </section>


   <!-- ================= Chamra Process Table ================= -->
  <section id="chamra-process" class="section-block bg-white">
    <div class="container">
      <div class="card modern-card shadow-sm border-0">
        <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
          <h5 class="mb-0">
            <i class="bi bi-file-earmark-check me-2 text-success"></i> ตารางสถานะการชำระบัญชี (Chamra Process)
          </h5>
          <div class="d-flex align-items-center gap-2">
            <span class="small text-muted">ขั้นตอน S1-S10</span>
            <a href="/chamra/process" class="btn btn-sm btn-outline-success rounded-pill">
              <i class="bi bi-list-ul me-1"></i> ดูทั้งหมด
            </a>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-sm table-bordered table-hover align-middle mb-0">
              <thead class="table-dark text-center">
                <tr>
                  <th>รหัส</th>
                  <th>S1</th><th>S2</th><th>S3</th><th>S4</th><th>S5</th>
                  <th>S6</th><th>S7</th><th>S8</th><th>S9</th><th>S10</th>
                </tr>
              </thead>
              <tbody>
                <% 
                  const isEmptyDate = (v) => {
                    if (!v) return true;
                    if (typeof v === 'string') {
                      if (v === '0000-00-00') return true;
                      if (/^1899-11-30/.test(v)) return true;
                    }
                    if (v instanceof Date) {
                      const y = v.getFullYear();
                      if (y < 1950) return true;
                    }
                    return false;
                  };
                  const formatThai = (v) => {
                    const raw = isEmptyDate(v) ? null : v;
                    if (!raw) return '-';
                    const d = raw instanceof Date ? raw : new Date(raw);
                    if (isNaN(d.getTime()) || d.getFullYear() < 1950) return '-';
                    const months = ['ม.ค.','ก.พ.','มี.ค.','เม.ย.','พ.ค.','มิ.ย.','ก.ค.','ส.ค.','ก.ย.','ต.ค.','พ.ย.','ธ.ค.'];
                    return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
                  };
                %>
                <% (chamraAllProcesses || []).slice(0, 10).forEach(p => { %>
                  <tr>
                    <td class="fw-semibold text-start">
                      <div class="small text-muted fw-normal"><%= p.c_name || '-' %></div>
                    </td>
                    <% for (let i=1;i<=10;i++){ 
                         const key='pr_s'+i; 
                         const raw = p[key];
                         const showDash = isEmptyDate(raw);
                    %>
                      <td class="text-center">
                        <% if (showDash) { %>
                          <span class="badge bg-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                              <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>  
                            </svg>
                          </span>
                        <% } else { %>
                          <span class="badge bg-success hp-badge"><%= formatThai(raw) %></span>
                        <% } %>
                      </td>
                    <% } %>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
          <% if (!chamraAllProcesses || chamraAllProcesses.length === 0) { %>
            <div class="text-center text-muted py-4">
              <i class="bi bi-info-circle me-2"></i>
              ไม่มีข้อมูลกระบวนการชำระบัญชี
            </div>
          <% } else if (chamraAllProcesses.length > 10) { %>
            <div class="card-footer bg-light text-end">
              <small class="text-muted">
                <i class="bi bi-info-circle me-1"></i>
                แสดง <%= Math.min(10, chamraAllProcesses.length) %> รายการจากทั้งหมด <%= chamraAllProcesses.length %> รายการ
              </small>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </section>




  <!-- ================= Member Summary ================= -->
  <section id="member-summary" class="section-block bg-light">
    <div class="container">
      <div class="card modern-card shadow-sm border-0">
        <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
          <h5 class="mb-0">
            <i class="bi bi-people-fill me-2 text-success"></i>สรุปจำนวนสมาชิกปีล่าสุด
          </h5>
          <span class="small text-muted">ปี <%= _latestYear %> | ฐานข้อมูล addmem</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0" style="font-size: 0.95rem;">
              <thead class="table-light">
                <tr>
                  <th rowspan="2" class="align-middle border-end text-center">ประเภทสถาบัน</th>
                  <th colspan="2" class="text-center border-end">สหกรณ์</th>
                  <th colspan="2" class="text-center">กลุ่มเกษตรกร</th>
                </tr>
                <tr>
                  <th class="text-end text-muted fw-normal">สามัญ</th>
                  <th class="text-end text-muted fw-normal border-end">สมทบ</th>
                  <th class="text-end text-muted fw-normal">สามัญ</th>
                  <th class="text-end text-muted fw-normal">สมทบ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="border-end fw-medium"><i class="bi bi-tree me-2 text-success"></i>ภาคการเกษตร</td>
                  <td class="text-end"><%= Number(_memberSummary.coop_agri_saman || 0).toLocaleString() %></td>
                  <td class="text-end border-end"><%= Number(_memberSummary.coop_agri_somtob || 0).toLocaleString() %></td>
                  <td class="text-end text-muted bg-light">-</td>
                  <td class="text-end text-muted bg-light">-</td>
                </tr>
                <tr>
                  <td class="border-end fw-medium"><i class="bi bi-building me-2 text-primary"></i>นอกภาคการเกษตร</td>
                  <td class="text-end"><%= Number(_memberSummary.coop_non_agri_saman || 0).toLocaleString() %></td>
                  <td class="text-end border-end"><%= Number(_memberSummary.coop_non_agri_somtob || 0).toLocaleString() %></td>
                  <td class="text-end text-muted bg-light">-</td>
                  <td class="text-end text-muted bg-light">-</td>
                </tr>
                <tr>
                  <td class="border-end fw-medium"><i class="bi bi-flower1 me-2 text-warning"></i>กลุ่มเกษตรกร</td>
                  <td class="text-end text-muted bg-light">-</td>
                  <td class="text-end text-muted bg-light border-end">-</td>
                  <td class="text-end"><%= Number(_memberSummary.farmer_group_saman || 0).toLocaleString() %></td>
                  <td class="text-end"><%= Number(_memberSummary.farmer_group_somtob || 0).toLocaleString() %></td>
                </tr>
              </tbody>
              <tfoot class="table-light">
                <tr>
                  <th class="border-end text-end">รวมทั้งหมด</th>
                  <th class="text-end text-primary"><%= Number((_memberSummary.coop_agri_saman || 0) + (_memberSummary.coop_non_agri_saman || 0)).toLocaleString() %></th>
                  <th class="text-end text-primary border-end"><%= Number((_memberSummary.coop_agri_somtob || 0) + (_memberSummary.coop_non_agri_somtob || 0)).toLocaleString() %></th>
                  <th class="text-end text-primary"><%= Number(_memberSummary.farmer_group_saman || 0).toLocaleString() %></th>
                  <th class="text-end text-primary"><%= Number(_memberSummary.farmer_group_somtob || 0).toLocaleString() %></th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
        <div class="card-footer bg-light d-flex justify-content-between align-items-center">
          <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            แสดงข้อมูลสมาชิกปี <%= _latestYear %> จากฐานข้อมูล addmem
          </small>
          <a href="/addmem/list" class="btn btn-success btn-sm">
            ดูข้อมูลสมาชิกทั้งหมด
          </a>
        </div>
      </div>
    </div>
  </section>

<!-- ================= Turnover Fiscal Summary ================= -->
<% const tfSummary = Array.isArray(turnoverFiscalSummary) ? turnoverFiscalSummary : []; %>
<section class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="h5 mb-1"><i class="bi bi-cash-stack me-2"></i>สรุปปริมาณธุรกิจรวมรายปี (ปีงบประมาณ)</h2>
      <div class="text-muted small">นับปีงบประมาณ ก.ย. - ส.ค. (เฉพาะข้อมูลปริมาณธุรกิจ)</div>
    </div>
    <div class="d-flex gap-2">
      <a href="/turnover" class="btn btn-outline-primary btn-sm"><i class="bi bi-file-earmark-spreadsheet me-1"></i>ดูรายละเอียด</a>
    </div>
  </div>

  <% if (!tfSummary.length) { %>
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      <div>ยังไม่มีข้อมูลปริมาณธุรกิจ</div>
    </div>
  <% } else { %>
    <div class="card shadow-sm border-0">
      <div class="table-responsive mb-0">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 160px;">ปีงบประมาณ</th>
              <th class="text-end" style="width: 140px;">จำนวนแห่ง</th>
              <th class="text-end">ปริมาณธุรกิจรวม</th>
            </tr>
          </thead>
          <tbody>
            <% tfSummary.forEach((row) => { %>
              <tr>
                <td class="fw-medium">พ.ศ. <%= (row.fiscal_year + 543).toString() %></td>
                <td class="text-end"><%= Number(row.coop_count || 0).toLocaleString() %></td>
                <td class="text-end fw-semibold"><%= Number(row.total_amount || 0).toLocaleString() %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  <% } %>
</section>
<section class="container py-4">
  <div class="card modern-card shadow-sm border-0  mt-1">
      <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
        <h5 class="mb-0">
          <i class="bi bi-award me-2" style="color: var(--primary);"></i>สรุปความเข้มแข็ง (st_grade) แยกตามประเภทสถาบัน
          <span class="small text-muted">(สหกรณ์ภาคการเกษตร/สหกรณ์นอกภาคการเกษตร/กลุ่มเกษตรกร)</span>
        </h5>
        <div class="d-flex align-items-center gap-2">
          <span class="small text-muted">ปี <%= _summaryYear %></span>
          <a href="/strength/list" class="btn btn-sm" style="background: var(--primary-light); color: var(--primary); border: 1px solid var(--primary);">ดูทั้งหมด</a>
        </div>
      </div>
      <div class="card-body p-0">
        <% if (_gradeSummary.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-sm mb-0">
            <thead style="background: var(--bg-light); border-bottom: 2px solid var(--border-color);">
              <tr>
                <th style="color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">ประเภทสหกรณ์</th>
                <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">จำนวนทั้งหมด</th>
                <th style="text-align: center; color: var (--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">ชั้น 1</th>
                <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">ชั้น 2</th>
                <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">ชั้น 3</th>
              </tr>
            </thead>
            <tbody>
              <% _gradeSummary.forEach((row) => { %>
              <tr style="border-bottom: 1px solid var(--border-color); transition: var(--transition);">
                <td style="padding: 12px; font-weight: 600; color: var(--text-primary); text-align: left;">
                  <i class="bi bi-building me-2" style="color: var(--primary);"></i><%= row.group_name %>
                </td>
                <td style="text-align: center; padding: 12px;">
                  <span style="background: var(--primary-light); color: var(--primary); padding: 6px 12px; border-radius: 8px; font-weight: 700; border: 1px solid var(--primary);">
                    <%= row.total_count %>
                  </span>
                </td>
                <td style="text-align: center; padding: 12px;">
                  <span style="background: #d1fae5; color: #059669; padding: 6px 12px; border-radius: 8px; font-weight: 700; border: 1px solid #10b981;">
                    <%= row.grade_1_count %>
                  </span>
                </td>
                <td style="text-align: center; padding: 12px;">
                  <span style="background: #fef3c7; color: #d97706; padding: 6px 12px; border-radius: 8px; font-weight: 700; border: 1px solid #f59e0b;">
                    <%= row.grade_2_count %>
                  </span>
                </td>
                <td style="text-align: center; padding: 12px;">
                  <span style="background: #fee2e2; color: #dc2626; padding: 6px 12px; border-radius: 8px; font-weight: 700; border: 1px solid #ef4444;">
                    <%= row.grade_3_count %>
                  </span>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
        <% } else { %>
        <div class="text-center text-muted py-3">ไม่มีข้อมูล</div>
        <% } %>
      </div>
    </div>
</section>
  <!-- ================= New Strength Snapshot ================ -->
  <% const nsRaw = (typeof newStrengthList !== 'undefined') ? newStrengthList : []; %>
  <% const nsList = Array.isArray(nsRaw) ? nsRaw : []; %>
  <section class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h2 class="h5 mb-1"><i class="bi bi-bar-chart-steps me-2"></i>ผลจัดชั้นความเข้มแข็งสหกรณ์และกลุ่มเกษตรกร 2569 </h2>
      </div>
      <div class="d-flex gap-2">
        <a href="/newstrength" class="btn btn-outline-primary btn-sm"><i class="bi bi-list-ul me-1"></i>รายการทั้งหมด</a>
      </div>
    </div>

    <% if (!nsList.length) { %>
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      <div>ยังไม่มีข้อมูลเข้มแข็งประมาณการ</div>
    </div>
    <% } else { %>
    <div class="card shadow-sm border-0">
      <div class="table-responsive mb-0">
        <table class="table align-middle mb-0">
          <thead style=" border-bottom: 2px solid var(--border-color);" class="bg-success bg-opacity-10">
            <tr>
               <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">#</th>
               <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">รหัส</th>
               <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">ชื่อสหกรณ์/กลุ่มเกษตรกร</th>
               <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">กลุ่ม</th>
               <th style="text-align: center; color: var(--text-secondary); font-weight: 700; padding: 12px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">ผลจัดชั้น</th>
            </tr>
          </thead>
          <tbody>
            <% nsList.forEach((row, idx) => { %>
              <tr>
                <td class="text-center text-muted small"><%= idx + 1 %></td>
                <td><span class="badge bg-light text-dark border"><%= row.str_code %></span></td>
                <td class="fw-medium text-primary"><%= row.c_name || '-' %></td>
                <td><span class="text-muted"><%= row.str_group %></span></td>
                <td class="text-center">
                  <span class="badge <%= row.str_grade ? 'bg-success' : 'bg-secondary' %>"><%= row.str_grade || '-' %></span>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  <% } %>
</section>

<!-- ================= Activities Calendar (RESTORE) ================= -->
<section id="activities" class="section-block bg-white">
  <div class="container-lg">
    <div class="card modern-card shadow-sm border-0">
      <div class="card-gradient-bar"></div>
      <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
        <h5 class="mb-0">
          <i class="bi bi-calendar3 me-2 text-success"></i> ปฏิทินงาน
        </h5>
        <button type="button" id="openActivityListBtn" class="btn btn-sm btn-outline-primary rounded-pill">
          <i class="bi bi-list-ul me-1"></i> ดูรายการ
        </button>
      </div>
      <div class="card-body">
        <!-- สำคัญ: จุดวาง FullCalendar -->
        <div id="activitiesCalendar" aria-label="ปฏิทินงาน"></div>

        <!-- fallback ถ้า FullCalendar/JS โหลดไม่สำเร็จ -->
        <div id="activitiesCalendarFallback" class="alert alert-light border mt-3 d-none">
          ไม่สามารถโหลดปฏิทินได้ กรุณารีเฟรชหน้า หรือแจ้งผู้ดูแลระบบ
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Activity single detail modal (KEEP only ONE) -->
<div class="modal fade modal-elevated" id="activityModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header modal-gradient py-2">
        <h5 class="modal-title mb-0"><i class="bi bi-info-circle me-1"></i> รายละเอียดกิจกรรม</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <dl class="row mb-0">
          <dt class="col-4">วันที่</dt>
          <dd class="col-8" id="acDate">-</dd>
          <dt class="col-4">เวลา</dt>
          <dd class="col-8" id="acTime">-</dd>
          <dt class="col-4">สถานที่</dt>
          <dd class="col-8" id="acPlace">-</dd>
          <dt class="col-4">กิจกรรม</dt>
          <dd class="col-8" id="acTitle">-</dd>
          <!-- Added: show participants / co_person -->
          <dt class="col-4">ผู้เข้าร่วม</dt>
          <dd class="col-8" id="acParticipants">-</dd>
        </dl>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ปิด</button>
      </div>
    </div>
  </div>
</div>

<!-- Activity list modal (KEEP only ONE) -->
<div class="modal fade modal-elevated" id="activityListModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header modal-gradient py-2">
        <h5 class="modal-title mb-0"><i class="bi bi-list-ul me-1"></i> รายการกิจกรรม</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <input type="text" class="modal-search-bar" id="activityFilter" placeholder="🔍 ค้นหากิจกรรม..." />
          <div class="small text-muted" id="activityCount"></div>
        </div>
        <div class="table-responsive">
          <table class="table table-sm table-modern table-bordered table-hover align-middle mb-0">
            <thead>
              <tr class="text-center">
                <th class="col-index d-none d-sm-table-cell">#</th>
                <th class="text-start">วันที่</th>
                <th class="text-start">กิจกรรม</th>
              </tr>
            </thead>
            <tbody id="activityTbody">
              <% (activity||[]).forEach((a,i)=>{ const d=new Date(a.date_act); %>
              <tr data-name="<%= (a.activity||'').toLowerCase() %> <%= d.toISOString().slice(0,10) %>">
                <td class="text-center"><%= i+1 %></td>
                <td><%= d.toLocaleDateString('th-TH', { year:'numeric', month:'long', day:'numeric'}) %></td>
                <td><%= a.activity %></td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ปิด</button>
      </div>
    </div>
  </div>
</div>

<section id="rules" class="section-block bg-white">
  <div class="container-lg">
    <div class="card modern-card mb-4">
      <div class="card-gradient-bar"></div>
      <div class="card-header bg-success text-dark">
        <i class="bi bi-file-earmark-text me-2"></i> ปฏิทินกิจกรรมประจำเดือน <%= new Date().toLocaleString('th-TH', { month: 'long', year: 'numeric' }) %>
      </div>
      <div class="card-body">
        <% 
          const rulesNow = new Date();
          const rulesToday = new Date(rulesNow.getFullYear(), rulesNow.getMonth(), rulesNow.getDate());
          const rulesLastDayOfMonth = new Date(rulesNow.getFullYear(), rulesNow.getMonth() + 1, 0);
        %>
        <ul class="list-group list-group-flush">
          <% (activity || [])
            .filter(acti => { 
              const d = new Date(acti.date_act); 
              const actDateOnly = new Date(d.getFullYear(), d.getMonth(), d.getDate());
              return actDateOnly >= rulesToday && actDateOnly <= rulesLastDayOfMonth; 
            })
            .forEach(acti => { %>
          <li class="list-group-item">
            <i class="bi bi-calendar-event me-2 text-success"></i>
            <% const actDate = new Date(acti.date_act); %>
            <%= actDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' }) %> -
            <%= acti.activity %>
            <% if (actDate.toDateString() === rulesNow.toDateString()) { %>
            <span class="badge bg-danger ms-2"><i class="bi bi-stars"></i> วันนี้</span>
            <% } %>
          </li>
          <% }) %>
        </ul>
      </div>
      <div class="text-end mt-2">
        <a href="/gitgum/list" class="btn btn-primary btn-sm">
          ดูทั้งหมด
        </a>
      </div>
    </div>
  </div>
</section>

<%- include('home/vong-latest.ejs') %>

<%- include('home/assets-summary.ejs') %>

<section id="downloads" class="section-block bg-white">
  <div class="container-lg">
    <div class="card modern-card">
      <div class="card-gradient-bar"></div>
      <div class="card-header bg-success text-dark">
        <i class="bi bi-trophy me-2"></i> Top 10 ดาวน์โหลดล่าสุด
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-bordered table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th class="col-index d-none d-sm-table-cell">#</th>
                <th>เรื่อง</th>
                <th class="text-nowrap">ไฟล์</th>
                <th class="text-center">ลิงก์</th>
                <th class="text-nowrap">วันที่</th>
              </tr>
            </thead>
            <tbody id="topDownloadsTbody">
              <tr>
                <td colspan="5" class="text-muted">กำลังโหลด...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer bg-light text-end">
        <a href="/down" class="btn btn-sm btn-outline-secondary">ดูทั้งหมด</a>
      </div>
    </div>
  </div>
</section>

<!-- ================= Latest Commands ================= -->
<section id="latest-commands" class="section-block bg-light">
  <div class="container">
    <h2 class="my-4 text-center text-primary section-title">
      <i class="bi bi-file-earmark-text me-2"></i> 10 คำสั่งล่าสุด
    </h2>
    <div class="card modern-card shadow-sm border-0">
      <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
        <h5 class="mb-0">
          <i class="bi bi-file-earmark-text me-2 text-primary"></i> คำสั่งล่าสุด
        </h5>
        <div class="d-flex align-items-center gap-2">
          <span class="small text-muted">ดูทั้งหมด</span>
          <a href="/command" class="btn btn-sm" style="background: var(--primary-light); color: var(--primary); border: 1px solid var(--primary);">
            ดูทั้งหมด
          </a>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="text-center">เลขที่</th>
                <th>เรื่อง</th>
              
                <th class="text-center">ดำเนินการ</th>
              </tr>
            </thead>
            <tbody>
              <% if (lastCommands && lastCommands.length > 0) { %>
                <% lastCommands.forEach((command, index) => { %>
                  <tr>
                    <td class="text-center"><%= command.com_no || '-' %></td>
                    <td>
                     
                      
                      <% if (command.com_story) { %>
                        <div class="text-truncate" title="<%= command.com_story %>"><%= command.com_story %></div>
                      <% } %>
                    </td>
                    <td class="text-center">
                      <% if (command.com_filename) { %>
                        <a href="/command/download/<%= command.command_id %>" class="btn btn-sm btn-outline-primary" target="_blank" title="เปิดอ่านไฟล์">
                          <i class="bi bi-file-earmark-pdf"></i>
                        </a>
                      <% } else { %>
                        <span class="text-muted small">ไม่มีไฟล์</span>
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="4" class="text-center text-muted py-3">ไม่มีข้อมูลคำสั่งล่าสุด</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ================= Latest Projects ================= -->
<section id="latest-projects" class="section-block bg-light">
  <div class="container">
    <h2 class="text-center text-primary section-title">
      <i class="bi bi-file-earmark-text me-2"></i> 10 โครงการล่าสุด
    </h2>
    <div class="card modern-card shadow-sm border-0">
      <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
        <h5 class="mb-0">
          <i class="bi bi-file-earmark-text me-2 text-primary"></i> โครงการล่าสุด
        </h5>
        <div class="d-flex align-items-center gap-2">
          <span class="small text-muted">ดูทั้งหมด</span>
          <a href="/projects" class="btn btn-sm" style="background: var(--primary-light); color: var(--primary); border: 1px solid var(--primary);">
            ดูทั้งหมด
          </a>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="text-center">ลำดับ</th>
                <th>โครงการ</th>
             
              </tr>
            </thead>
            <tbody>
              <% if (lastProjects && lastProjects.length > 0) { %>
                <% lastProjects.forEach((project, index) => { %>
                  <tr>
                    <td class="text-center"><%= index + 1 %></td>
                    <td>
                      <%= project.pro_story || '-' %>
                      <% if (project.pro_filename) { %>
                        <a href="/project/download/<%= project.pro_id %>" class="btn btn-sm btn-outline-primary ms-2" target="_blank">
                          <i class="bi bi-download"></i> ดาวน์โหลด
                        </a>
                      <% } %>
                    </td>
             
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="4" class="text-center text-muted py-3">ไม่มีข้อมูลโครงการล่าสุด</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ================= Articles (List View) ================= -->



<section id="usecar" class="section-block">
  <div class="container-lg">
    <div class="row mt-4" id="usecarSection">
      <div class="col-12">
        <h2 class="mb-4 text-center text-primary section-title">
          <i class="bi bi-car-front-fill me-2"></i> รายการใช้รถ
        </h2>
        <div class="card modern-card shadow-sm border-0">
          <div class="card-gradient-bar"></div>
          <div class="card-body">
            <div class="row">
              <% usecars.slice(0, 5).forEach((usecar)=> { %>
              <div class="col-12 col-md-6 mb-3">
                <div class="list-group">
                  <div class="list-group-item">
                    <div class="d-flex justify-content-between align-items-start">
                      <div class="ms-2 me-auto">
                        <% const date=new Date(usecar.date_car); const options={ year: 'numeric' , month: 'long' ,
                            day: 'numeric' }; const thaiDate=date.toLocaleDateString('th-TH', options); const
                            today=new Date(); const
                            isToday=today.toLocaleDateString('th-TH')===date.toLocaleDateString('th-TH'); %>
                        <div class="fw-bold text-success mb-1">
                          <i class="bi bi-calendar-event me-1"></i>
                          <%= thaiDate %>
                          <span class="text-muted">(<i class="bi bi-clock"></i>
                            <%= usecar.time_car + ' น.' %>)
                          </span>
                          <% if (isToday) { %>
                          <span class="badge bg-danger ms-2"><i class="bi bi-stars"></i> วันนี้</span>
                          <% } %>
                        </div>
                        <div class="text-dark mb-1">
                          <i class="bi bi-geo-alt-fill text-danger me-1"></i>
                          <%= usecar.place_car %>
                        </div>
                        <small class="text-muted d-block mb-2">
                          <i class="bi bi-clipboard2-check me-1"></i>
                          <%= usecar.act_car %>
                        </small>

                        <button type="button" class="btn btn-outline-primary btn-sm js-open-usecar" data-bs-toggle="modal" data-bs-target="#usecarModal" data-id="<%= usecar.id_usecar %>" data-date="<%= thaiDate %>" data-time="<%= usecar.time_car %>" data-place="<%= usecar.place_car %>" data-act="<%= usecar.act_car %>" data-respon="<%= usecar.respon_car %>" data-no-car="<%= usecar.no_car %>">
                          <i class="bi bi-info-circle me-1"></i> ดูข้อมูลเพิ่ม
                        </button>
                      </div>

                      <% if(user && user.mClass==='admin' ){ %>
                      <div class="d-flex align-items-center ms-3">
                        <a href="/usecar/edit/<%= usecar.id_usecar %>" class="btn btn-outline-warning btn-sm me-2">
                          <i class="bi bi-pencil-square"></i>
                        </a>
                        <form action="/usecar/delete/<%= usecar.id_usecar %>" method="POST" style="display: inline;">
                          <button type="submit" class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-trash3"></i>
                          </button>
                        </form>
                      </div>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
              <% }); %>
            </div>

            <div class="row mt-2">
              <div class="col-12 text-center">
                <a href="/usecar" class="btn btn-primary rounded-pill px-4">
                  <i class="bi bi-car-front me-2"></i> ดูรายการใช้รถทั้งหมด
                </a>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Added: Usecar Detail Modal -->
<div class="modal fade" id="usecarModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header modal-gradient py-2">
        <h5 class="modal-title mb-0"><i class="bi bi-car-front-fill me-1"></i> รายละเอียดการใช้รถ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="usecarModalLoading" class="text-center d-none">
          <div class="spinner-border text-primary mb-3" role="status"></div>
          <div class="small text-muted">กำลังโหลด...</div>
        </div>
        <div id="usecarModalError" class="alert alert-danger d-none"></div>
        <dl class="row mb-0" id="usecarModalContent">
          <dt class="col-4">วันที่</dt>
          <dd class="col-8" id="ucDate">-</dd>
          <dt class="col-4">เวลา</dt>
          <dd class="col-8" id="ucTime">-</dd>
          <dt class="col-4">ทะเบียนรถ</dt>
          <dd class="col-8" id="ucNoCar">-</dd>
          <dt class="col-4">สถานที่</dt>
          <dd class="col-8" id="ucPlace">-</dd>
          <dt class="col-4">กิจกรรม</dt>
          <dd class="col-8" id="ucAct">-</dd>
          <dt class="col-4">ผู้รับผิดชอบ</dt>
          <dd class="col-8" id="ucRespon">-</dd>
        </dl>
      </div>
    </div>
  </div>
</div>

<script>
  // Usecar modal populate (client-side only using data-* attributes)
  (function() {
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('.js-open-usecar');
      if (!btn) return;
      const date = btn.getAttribute('data-date') || '-';
      const time = btn.getAttribute('data-time') || '-';
      const place = btn.getAttribute('data-place') || '-';
      const act = btn.getAttribute('data-act') || '-';
      const respon = btn.getAttribute('data-respon') || '-';
      const noCar = btn.getAttribute('data-no-car') || '-';
      document.getElementById('ucDate').textContent = date;
      document.getElementById('ucTime').textContent = time + ' น.';
      document.getElementById('ucNoCar').textContent = noCar;
      document.getElementById('ucPlace').textContent = place;
      document.getElementById('ucAct').textContent = act;
      document.getElementById('ucRespon').textContent = respon;
      // If Bootstrap auto trigger fails for some reason, ensure show programmatically
      const modalEl = document.getElementById('usecarModal');
      if (modalEl) {
        const instance = bootstrap && bootstrap.Modal ? bootstrap.Modal.getOrCreateInstance(modalEl) : null;
        if (instance) instance.show();
      }
    });
  })();
</script>

<section id="online" class="section-block bg-light">
  <div class="container-lg">
    <div class="row">
      <div class="col-md-4">
        <div class="card modern-card shadow-sm border-0 h-100">
          <div class="card-gradient-bar"></div>
          <div class="card-body text-center">
            <h5 class="card-title">📈 ข้อมูลการใช้งาน</h5>
            <div class="mb-3">
              <div class="display-4 text-success" id="onlineCountValue" aria-live="polite" aria-label="บุคคลทั่วไปออนไลน์">
                <%= onlineCount %>
              </div>
              <small class="text-muted">บุคคลทั่วไปออนไลน์ขณะนี้</small>
            </div>
            <hr>
            <div class="row text-center">
              <h4 class="col-12 text-center">จำนวน</h4>
              <div class="col-md-4">
                <div class="h4 text-primary">
                  <%= stats.coop %>
                </div>
                <small>สหกรณ์</small>
              </div>
              <div class="col-md-4">
                <div class="h4 text-success">
                  <%= stats.farmer %>
                </div>
                <small>กลุ่มเกษตรกร</small>
              </div>
              <div class="col-md-4">
                <div class="h4 text-warning">
                  <%= stats.closing %>
                </div>
                <small>ชำระบัญชี</small>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8 mt-md-0">
        <h2 class="mb-4 text-center text-success section-title">🟢 Members Online</h2>

        <div class="card modern-card shadow-sm border-0">
          <div class="card-gradient-bar"></div>
          <div class="card-body">
            <div class="row">
              <% onlineUsers.forEach((user, index)=> { %>
              <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center">
                  <img src="<%= user.m_img || '/images/default-avatar.png' %>" alt="Avatar" class="rounded-circle me-3 avatar" loading="lazy" decoding="async">
                  <div>
                    <div class="fw-bold text-success">
                      <%= user.on_name %>
                    </div>
                    <small class="text-muted">
                      <%= user.m_position || '32ใช้' %>
                    </small>
                    <div class="badge bg-success ms-2">
                      <i class="bi bi-circle-fill small-dot"></i> ออนไลน์
                    </div>
                  </div>
                </div>
              </div>
              <% }); %>
            </div>

            <% if (onlineUsers.length===0) { %>
            <div class="text-center text-muted">
              <i class="bi bi-people-fill online-empty-icon"></i>
              <p>ไม่มีสมาชิกออนไลน์ในขณะนี้</p>
            </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<!-- ================= SCRIPTS (Enhancements added before existing scripts end) ================= -->
<!-- Load socket.io client for realtime online counter -->
<script src="/socket.io/socket.io.js"></script>

<script>
  // Socket: update onlineCount (ปรับให้ปลอดภัย + มี fallback)
  (function() {
    const el = document.getElementById('onlineCountValue');
    if (!el) return;
    let last = Number(el.textContent.trim()) || 0;
    let updated = false;

    try {
      const socket = io(); // ใช้ค่า default; ถ้ากำหนด path ให้ตรงกับ server
      socket.on('onlineUsers', (count) => {
        if (typeof count === 'number') {
          el.textContent = count;
          last = count;
          updated = true;
        }
      });
      socket.on('disconnect', () => {
        // ไม่เปลี่ยนค่า ให้ค้างไว้
      });
    } catch (e) {
      console.warn('Socket init failed:', e);
    }

    // Fallback: ถ้า 15s ไม่เคยอัปเดต แสดงค่าเดิมชัดเจน (ไม่กระทบ UX)
    setTimeout(() => {
      if (!updated) {
        el.textContent = last;
      }
    }, 15000);
  })();
</script>

<script>
  // Quick Nav Active State + Smooth Scroll
  (function() {
    const links = [...document.querySelectorAll('#quickNav a')];
    const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);

    function activate() {
      const y = window.scrollY + 120;
      let cur = null;
      sections.forEach(sec => {
        if (sec.offsetTop <= y) cur = sec;
      });
      if (!cur) return;
      links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === '#' + cur.id));
    }
    links.forEach(l => {
      l.addEventListener('click', e => {
        const target = document.querySelector(l.getAttribute('href'));
        if (target) {
          e.preventDefault();
          window.scrollTo({
            top: target.offsetTop - 70,
            behavior: 'smooth'
          });
        }
      });
    });
    window.addEventListener('scroll', activate, {
      passive: true
    });
    activate();
  })();
</script>

<script>
  // Reveal on scroll (with fallback when IntersectionObserver is unavailable)
  (function() {
    const revealEls = document.querySelectorAll('.reveal');
    if (!('IntersectionObserver' in window)) {
      revealEls.forEach(el => el.classList.add('in'));
      return;
    }
    const obs = new IntersectionObserver(entries => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('in');
          obs.unobserve(e.target);
        }
      });
    }, {
      threshold: .14
    });
    revealEls.forEach(el => obs.observe(el));
    document.querySelectorAll('.section-block').forEach(el => {
      el.classList.add('reveal');
      obs.observe(el);
    });
  })();
</script>

<script>
  (function() {
    document.addEventListener('click', function(e) {
      const link = e.target.closest('.js-coop-detail');
      if (!link) return;
      e.preventDefault();
      const code = link.getAttribute('data-code');
      const modalEl = document.getElementById('coopDetailModal');
      const labelEl = document.getElementById('coopDetailModalLabel');
      const loadingEl = document.getElementById('coopDetailLoading');
      const errorEl = document.getElementById('coopDetailError');
      const contentEl = document.getElementById('coopDetailContent');
      if (!modalEl) return;
      labelEl.innerHTML = '<i class="bi bi-building me-1"></i> รายละเอียดสถาบัน (' + code + ')';
      loadingEl.classList.remove('d-none');
      errorEl.classList.add('d-none');
      contentEl.classList.add('d-none');
      contentEl.innerHTML = '';

      fetch('/allCoop/profile/' + encodeURIComponent(code))
        .then(r => r.text())
        .then(html => {
          loadingEl.classList.add('d-none');
          try {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            let container = doc.querySelector('main') || doc.querySelector('.container') || doc.body;
            container.querySelectorAll('a, button').forEach(el => {
              if (/ย้อนกลับ/.test(el.textContent)) el.remove();
            });
            let extracted = container.innerHTML;
            extracted = extracted.replace(/<script[\s\S]*?<\/script>/gi, '');
            contentEl.innerHTML = '<div class="coop-modal-inner">' + extracted + '</div>';
          } catch (err) {
            console.error('coop detail parse error', err);
            contentEl.innerHTML = '<div class="alert alert-warning">ไม่สามารถแสดงผลได้</div>';
          }
          contentEl.classList.remove('d-none');
        })
        .catch(err => {
          loadingEl.classList.add('d-none');
          errorEl.textContent = 'เกิดข้อผิดพลาดในการโหลดข้อมูล';
          errorEl.classList.remove('d-none');
          console.error('coop detail fetch error', err);
        });

      const bsModal = (window.bootstrap && bootstrap.Modal) ? new bootstrap.Modal(modalEl) : null;
      if (bsModal) bsModal.show();
    });
  })();
</script>

<script>
  // Quick Nav Active State + Smooth Scroll
  (function() {
    const links = [...document.querySelectorAll('#quickNav a')];
    const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);

    function activate() {
      const y = window.scrollY + 120;
      let cur = null;
      sections.forEach(sec => {
        if (sec.offsetTop <= y) cur = sec;
      });
      if (!cur) return;
      links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === '#' + cur.id));
    }
    links.forEach(l => {
      l.addEventListener('click', e => {
        const target = document.querySelector(l.getAttribute('href'));
        if (target) {
          e.preventDefault();
          window.scrollTo({
            top: target.offsetTop - 70,
            behavior: 'smooth'
          });
        }
      });
    });
    window.addEventListener('scroll', activate, {
      passive: true
    });
    activate();
  })();
</script>

<script>
  // Init Charts lazily when charts section becomes visible
  (function() {
    const chartsSection = document.getElementById('charts');
    if (!chartsSection) return;
    let inited = false;
    const start = () => {
      if (inited) return;
      inited = true;
      const barEl = document.getElementById('coopChart');
      const pieEl = document.getElementById('coopPieChart');
      const dataEl = document.getElementById('template-data');
      if (!barEl && !pieEl) return;
      if (!dataEl) return;
      let stats = {
        coop: 0,
        farmer: 0,
        closing: 0
      };
      try {
        const raw = dataEl.getAttribute('data-stats');
        stats = typeof raw === 'string' ? JSON.parse(raw) : (raw || stats);
      } catch (e) {}
      const coop = Number(stats.coop) || 0;
      const farmer = Number(stats.farmer) || 0;
      const closing = Number(stats.closing) || 0;
      if (typeof Chart === 'undefined') return; // library not ready
      // Global font to match site
      try {
        Chart.defaults.font.family = 'Sarabun, system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
      } catch (e) {}

      if (barEl) {
        const ctx = barEl.getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['สหกรณ์', 'กลุ่มเกษตรกร', 'ชำระบัญชี'],
            datasets: [{
              label: 'จำนวน (แห่ง)',
              data: [coop, farmer, closing],
              backgroundColor: ['#16a34a', '#0ea5e9', '#f59e0b'],
              borderWidth: 0,
              borderRadius: 8,
              maxBarThickness: 46
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
              duration: 350,
              easing: 'easeOutQuart'
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                enabled: true
              },
              datalabels: {
                anchor: 'end',
                align: 'top',
                color: '#1f2937',
                font: {
                  weight: 'bold',
                  size: 12
                },
                formatter: (value) => value.toLocaleString('th-TH')
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }

      if (pieEl) {
        const ctxPie = pieEl.getContext('2d');
        new Chart(ctxPie, {
          type: 'doughnut',
          data: {
            labels: ['สหกรณ์', 'กลุ่มเกษตรกร'],
            datasets: [{
              data: [coop, farmer],
              backgroundColor: ['#16a34a', '#0ea5e9'],
              borderWidth: 0
            }]
          },
          options: {
            cutout: '58%',
            animation: {
              duration: 350,
              easing: 'easeOutQuart'
            },
            plugins: {
              legend: {
                position: 'bottom'
              },
              tooltip: {
                enabled: true
              },
              datalabels: {
                color: '#ffffff',
                font: {
                  weight: 'bold',
                  size: 14
                },
                formatter: (value, context) => {
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${value}\n(${percentage}%)`;
                }
              }
            }
          }
        });
      }
    };

    if ('IntersectionObserver' in window) {
      const io = new IntersectionObserver((entries, obs) => {
        if (entries.some(e => e.isIntersecting)) {
          obs.disconnect();
          start();
        }
      }, {
        rootMargin: '200px'
      });
      io.observe(chartsSection);
    } else {
      window.addEventListener('load', start);
    }
  })();
</script>

<!-- Init Chamra stages chart -->
<script>
  window.addEventListener('load', function() {
    const tdata = document.getElementById('template-data');
    const canvas = document.getElementById('chamraStageChart');
    if (!tdata || !canvas || typeof Chart === 'undefined') return;

    // Register the datalabels plugin
    if (typeof ChartDataLabels !== 'undefined') {
      Chart.register(ChartDataLabels);
    }

    let stages = null;
    try {
      const raw = tdata.getAttribute('data-chamra-stages');
      stages = raw ? JSON.parse(raw) : null;
    } catch (e) {}
    if (!stages) return;

    const labels = Array.from({
      length: 10
    }, (_, i) => 'S' + (i + 1));
    const values = labels.map(k => Number(stages[k] || 0));

    const ctx = canvas.getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'จำนวนสถาบัน (แห่ง)',
          data: values,
          backgroundColor: '#6366f1',
          borderWidth: 0,
          borderRadius: 8,
          maxBarThickness: 40
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: {
          duration: 350,
          easing: 'easeOutQuart'
        },
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            enabled: true
          },
          datalabels: {
            display: true,
            anchor: 'end',
            align: 'top',
            color: '#1f2937',
            font: {
              weight: 'bold',
              size: 12
            },
            formatter: (value) => value.toLocaleString('th-TH'),
            backgroundColor: 'rgba(255, 255, 255, 0.8)',
            borderColor: '#e5e7eb',
            borderWidth: 1,
            borderRadius: 4,
            padding: 4
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              precision: 0
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    });
  });
</script>

<!-- Init Activities calendar lazily when visible -->
<script>
  (function() {
    const calEl = document.getElementById('activitiesCalendar');
    const fallbackEl = document.getElementById('activitiesCalendarFallback');
    if (!calEl) return;

    let inited = false;

    const start = () => {
      if (inited) return;
      inited = true;

      if (typeof FullCalendar === 'undefined') {
        if (fallbackEl) fallbackEl.classList.remove('d-none');
        return;
      }

      function formatThaiDate(d) {
        try {
          return d.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
        } catch (e) {
          return d.toISOString().slice(0, 10);
        }
      }

      const tDataEl = document.getElementById('template-data');
      let activities = [];
      try {
        const raw = tDataEl ? tDataEl.getAttribute('data-activities') : '[]';
        activities = raw ? JSON.parse(raw) : [];
      } catch (e) {
        activities = [];
      }

      const events = (activities || []).map((a, idx) => ({
        id: String(idx + 1),
        title: a.activity || '-',
        start: a.date_act,
        allDay: true,
        extendedProps: { raw: a }
      }));

      const calendar = new FullCalendar.Calendar(calEl, {
        initialView: 'dayGridMonth',
        initialDate: new Date(),
        locale: 'th',
        height: 'auto',
        headerToolbar: { left: 'prev,next today', center: 'title', right: '' },
        buttonText: { today: 'วันนี้' },
        navLinks: true,
        editable: false,
        fixedWeekCount: false,
        showNonCurrentDates: false,
        dayMaxEventRows: 2,
        events,
        eventClick(info) {
          const ev = info.event;
          const raw = ev.extendedProps?.raw || {};
          const d = ev.start ? new Date(ev.start) : null;

          const modalEl = document.getElementById('activityModal');
          if (!modalEl) return;

          document.getElementById('acDate').textContent = d ? formatThaiDate(d) : '-';
          document.getElementById('acTitle').textContent = raw.activity || ev.title || '-';
          document.getElementById('acTime').textContent = raw.act_time ? (raw.act_time + ' น.') : '-';
          document.getElementById('acPlace').textContent = raw.place || '-';
          document.getElementById('acParticipants').textContent = raw.co_person || '-';

          const modal = (window.bootstrap && bootstrap.Modal) ? new bootstrap.Modal(modalEl) : null;
          if (modal) modal.show();
        }
      });

      calendar.render();

      // List modal open button
      const btnList = document.getElementById('openActivityListBtn');
      if (btnList) {
        btnList.addEventListener('click', function() {
          const el = document.getElementById('activityListModal');
          const m = (window.bootstrap && bootstrap.Modal) ? new bootstrap.Modal(el) : null;
          if (m) m.show();
          const countEl = document.getElementById('activityCount');
          const rows = document.querySelectorAll('#activityTbody tr');
          if (countEl) countEl.textContent = 'ทั้งหมด ' + rows.length + ' รายการ';
        });
      }
    };

    if ('IntersectionObserver' in window) {
      const io = new IntersectionObserver((entries, obs) => {
        if (entries.some(e => e.isIntersecting)) {
          obs.disconnect();
          start();
        }
      }, { rootMargin: '200px' });
      io.observe(calEl);
    } else {
      window.addEventListener('load', start);
    }
  })();

  // Load Top 10 Downloads
  (function() {
    async function loadTopDownloads() {
      try {
        const response = await fetch('/down/top10');
        if (!response.ok) throw new Error('Failed to load downloads');
        
        const downloads = await response.json();
        const tbody = document.getElementById('topDownloadsTbody');
        
        if (!tbody) return;
        
        if (downloads && downloads.length > 0) {
          tbody.innerHTML = downloads.map((down, index) => {
            const hasFile = down.down_file && down.down_file !== '-';
            const hasLink = down.down_link && down.down_link !== '-';
            const downloadUrl = hasFile ? `/down/download/${down.down_id}` : down.down_link;
            const linkTarget = hasFile ? '_blank' : '_blank';
            const linkText = hasFile ? 'ดาวน์โหลด' : 'เปิดลิงก์';
            const linkIcon = hasFile ? 'bi-download' : 'bi-link-45deg';
            
            return `
              <tr>
                <td class="col-index d-none d-sm-table-cell text-center">${index + 1}</td>
                <td>
                  <div class="fw-medium">${down.down_subject || '-'}</div>
                </td>
                <td class="text-nowrap">
                  ${hasFile ? '<span class="badge bg-success"><i class="bi bi-file-earmark me-1"></i>ไฟล์</span>' : '<span class="badge bg-info"><i class="bi bi-link me-1"></i>ลิงก์</span>'}
                </td>
                <td class="text-center">
                  <a href="${downloadUrl}" class="btn btn-sm btn-outline-primary" target="${linkTarget}" title="${linkText}">
                    <i class="bi ${linkIcon}"></i>
                  </a>
                </td>
                <td class="text-nowrap small text-muted">
                  ${down.down_savedate ? new Date(down.down_savedate).toLocaleDateString('th-TH') : '-'}
                </td>
              </tr>
            `;
          }).join('');
        } else {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-3">ไม่มีข้อมูลดาวน์โหลด</td></tr>';
        }
      } catch (error) {
        console.error('Error loading top downloads:', error);
        const tbody = document.getElementById('topDownloadsTbody');
        if (tbody) {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center text-danger py-3">โหลดข้อมูลไม่สำเร็จ</td></tr>';
        }
      }
    }

    // Load downloads when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadTopDownloads);
    } else {
      loadTopDownloads();
    }
  })();
</script>

<!-- Data template for charts and other components -->
<div id="template-data" 
  data-stats='<%= JSON.stringify(stats) %>'
  data-chamra-stages='<%= JSON.stringify(__chamraCounts || {}) %>'
  data-activities='<%= JSON.stringify(activity || []) %>'
  style="display: none;">
</div>

<%- include('partials/footer') %>
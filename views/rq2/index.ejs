<%- include('../partials/header', { title: 'RQ2' }) %>
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>RQ2</h3>
    <form class="d-flex" method="GET" action="">
      <input type="text" class="form-control me-2" name="search" placeholder="ค้นหาชื่อ (rq_name)" value="<%= search || '' %>">
      <button class="btn btn-outline-primary" type="submit">ค้นหา</button>
      <a href="/rq2" class="btn btn-outline-secondary ms-2">ล้าง</a>
    </form>
    <% if(user && user.mClass=='kjs'){ %>
    <a href="/rq2/create" class="btn btn-primary">Add</a>
    <% } %>
  </div>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Year</th>
        <th>File</th>
        <% if(user && user.mClass=='kjs'){ %>
        <th>Actions</th>
        <% } %>
      </tr>
    </thead>
    <tbody>
      <% items.forEach(p => { %>
        <tr>
          <td>
            <%= p.rq_name %>
            <% const pSavedDate = new Date(p.rq_savedate); const currentDate = new Date(); const diffDays = Math.ceil((currentDate - pSavedDate) / (1000 * 60 * 60 * 24)); %>
                      <% if (diffDays <= 7) { %>
                        <img src="https://websitearchive2020.nepa.gov.jm/new/images/gif/new-star.gif" alt="New"
                          class="ms-2" style="width: 45px; height: 32px;" />
                      <% } %>
          </td>
          <td><%= p.rq_year %></td>
          <td>
            <% if (user) { %>
              <a href="/rq2/download/<%= p.rq_id %>" target="_blank" class="btn btn-sm btn-outline-primary">file</a>
            <% }else{ %>
              <a href="/auth/login" class="btn btn-sm btn-outline-primary">เข้าสู่ระบบ</a>
            <% } %>
          </td>
          <% if(user && user.mClass=='kjs'){ %>
          <td class="text-nowrap">
            <a href="/rq2/edit/<%= p.rq_id %>" class="btn btn-warning btn-sm">Edit</a>
            <form action="/rq2/delete/<%= p.rq_id %>" method="POST" style="display:inline" onsubmit="return confirm('Delete?')">
              <button class="btn btn-danger btn-sm" type="submit">Delete</button>
            </form>
          </td>
          <% } %>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
<%- include('../partials/footer') %>

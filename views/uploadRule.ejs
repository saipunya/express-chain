<%- include('./partials/header') %>

<form action="/rule/upload" method="POST" enctype="multipart/form-data">
  <h3 class="mt-4">üì§ ‡∏Ç‡πâ‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå/‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</h3>
  
  <div class="mb-3">
    <label for="rule_name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå/‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</label>
    <select name="rule_name" id="rule_name" class="form-select" required>
      <option value="">++‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å++</option>
      <% alls.forEach(item => { %>
        <option value="<%= item.c_code %>" data-name="<%= item.c_name %>"><%= item.c_name %></option>
      <% }) %>
    </select>
    <input type="hidden" name="rule_code" id="rule_code">
  </div>

  <script>
  document.getElementById('rule_name').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const ruleCode = selectedOption.value;
    const ruleName = selectedOption.getAttribute('data-name');
    
    document.getElementById('rule_code').value = ruleCode;
    // rule_name ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å c_code ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ c_name
    this.setAttribute('data-selected-name', ruleName);
  });
  </script>
  
  <div class="mb-3">
    <label for="rule_type" class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
    <select name="rule_type" id="rule_type" class="form-select" required>
      <option value=""> ++ ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ++</option>
      <option value="MR">‡∏Ç‡πâ‡∏≠‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠</option>
      <option value="ER">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠</option>
    </select>
  </div>

  <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ ER ‡πÄ‡∏ó‡πà‡∏≤<|im_start|>‡πâ‡∏ô -->
  <div class="mb-3" id="er_no_div" style="display: none;">
    <label for="er_no" class="form-label">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠</label>
    <select name="er_no" class="form-select">
      <option value="" selected> ++ ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ++</option>
      <option value="1"> 1</option>
      <option value="2"> 2</option>
      <option value="3"> 3</option>
      <option value="4"> 4</option>
      <option value="5"> 5</option>
      <option value="6"> 6</option>
      <option value="7"> 7</option>
      <option value="8"> 8</option>
      <option value="9"> 9</option>
      <option value="10"> 10</option>
      <option value="11"> 11</option>
      <option value="12"> 12</option>

     
    </select>
  </div>

  <script>
  document.getElementById('rule_type').addEventListener('change', function() {
    const erNoDiv = document.getElementById('er_no_div');
    
    if (this.value === 'ER') {
      erNoDiv.style.display = 'block';
    } else {
      erNoDiv.style.display = 'none';
    }
  });
  </script>
  
  <div class="mb-3">
    <label for="rule_year" class="form-label"> ‡∏û.‡∏®.</label>
    <!-- select now year+543 , now year+543 + 1, now year+543 -1  -->
     <%   
     const nowYear = new Date().getFullYear() 
     %>
     <select name="rule_year" class="form-select">
      <option value="<%= nowYear + 542 %>"><%= nowYear + 542 %></option>
      <option value="<%= nowYear + 543 %>" selected><%= nowYear + 543 %></option>
      <option value="<%= nowYear + 544 %>"><%= nowYear + 544 %></option>
    </select>
  </div>
  
  <div class="mb-3">
    <label>‡πÑ‡∏ü‡∏•‡πå</label>
    <input type="file" name="file" class="form-control" required>
  </div>
  
  <button type="submit" class="btn btn-success">upload</button>
</form>

<hr>
<h5 class="mt-5">üìÇ ‡πÑ‡∏ü‡∏•‡πå<lemma></lemma></h5>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå/‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</th>
      <th> ‡∏û.‡∏®.</th>
      <th>‡πÇ‡∏î‡∏¢</th>
      <th>‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
      <th>‡πÑ‡∏ü‡∏•‡πå</th>
    </tr>
  </thead>
  <tbody>
    <% recentUploads.forEach(rule => { %>
      <tr>
        <td><%= rule.rule_name %></td>
        <td><%= rule.rule_year %></td>
        <td><%= rule.rule_saveby %></td>
        <td>
          <%= new Date(rule.rule_savedate).toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
          }) %>
        </td>
        <td>
          <a href="/rule/<%= rule.rule_id %>" class="btn btn-sm btn-outline-primary" target="_blank">
            <lemma></lemma>‡πÑ‡∏ü‡∏•‡πå
          </a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<div class="mt-4 text-end">
    <a href="/rule" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> ‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    </a>
</div>

<%- include('./partials/footer') %>

<%- include('../partials/header') %>
<% const searchQuery = (search && search.length) ? ('?q=' + encodeURIComponent(search)) : ''; %>
<div class="container">
  <h2>สหกรณ์ทั้งหมด <%= currentGroup ? ('กลุ่ม: ' + currentGroup) : '' %></h2>
  <div class="row">
    <div class="col-3">
      <h4>กลุ่ม</h4>
      <form class="mb-2" action="/allcoop/group" method="get">
        <div class="input-group input-group-sm mb-2">
          <input type="text" name="q" value="<%= search || '' %>" class="form-control" placeholder="ค้นหาชื่อ/รหัส/กลุ่ม">
          <button class="btn btn-primary" type="submit">ค้นหา</button>
        </div>
        <% if (search) { %>
          <a href="/allcoop/group" class="btn btn-link p-0 small">ล้างการค้นหา</a>
        <% } %>
      </form>
      <ul class="list-group mb-3" style="max-height:60vh; overflow:auto;">
        <li class="list-group-item <%= !currentGroup ? 'active' : '' %>">
          <a href="/allcoop/group<%= searchQuery %>" class="d-block text-decoration-none">ทั้งหมด</a>
        </li>
        <% if (groups && groups.length) { %>
          <% groups.forEach(g => { %>
            <% const gVal = (g.group || g.name || g.code || g).toString(); const gLink = '/allcoop/group/' + encodeURIComponent(gVal) + searchQuery; %>
            <li class="list-group-item <%= currentGroup === gVal ? 'active' : '' %>">
              <a href="<%= gLink %>" class="d-block text-decoration-none"><%= gVal %></a>
            </li>
          <% }) %>
        <% } else { %>
          <li class="list-group-item">(ไม่มีข้อมูลกลุ่ม)</li>
        <% } %>
      </ul>
    </div>
    <div class="col-9">
      <div class="d-flex justify-content-between align-items-center">
        <h4 class="mb-0">รายการสหกรณ์</h4>
        <div class="small text-muted">จำนวน: <%= coops ? coops.length : 0 %> รายการ <%= search ? ('(ค้นหา: ' + search + ')') : '' %></div>
      </div>
      <hr class="mt-2"/>
      <% if (coops && coops.length) { %>
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>#</th>
              <th>รหัส</th>
              <th>ชื่อ</th>
              <th>กลุ่ม</th>
            </tr>
          </thead>
          <tbody>
            <% coops.forEach((c,i) => { %>
              <tr>
                <td><%= i+1 %></td>
                <td><a href="/allcoop/profile/<%= c.c_code || c.code || '' %>"><%= c.c_code || c.code || '-' %></a></td>
                <td><%= c.c_name || c.name || '-' %></td>
                <td><%= c.c_group || c.coop_group || c.group || '' %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <div class="alert alert-info">ยังไม่มีข้อมูลสหกรณ์สำหรับเงื่อนไขนี้</div>
      <% } %>
    </div>
  </div>
</div>
<%- include('../partials/footer') %>
<%- include('../partials/header.ejs') %>

<div class="container mt-5">
  <h1 class="mb-4 text-center text-primary fw-bold">
    <i class="bi bi-calendar-range me-2"></i> กิจกรรมทั้งหมด
  </h1>

  <% if(user && (user.mClass==='pbt' || user.mClass==='admin')){ %>
    <div class="mb-3 text-end">
      <a href="/activities/create" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i> เพิ่มกิจกรรมใหม่
      </a>
    </div>
  <% } %>

  <div class="card shadow border-0 rounded-3">
    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-primary text-center">
          <tr>
            <th><i class="bi bi-calendar-event me-1"></i> วันที่</th>
            <th><i class="bi bi-stars me-1"></i> กิจกรรม</th>
            <th><i class="bi bi-geo-alt-fill me-1"></i> สถานที่</th>
            <th><i class="bi bi-tools me-1"></i> จัดการ</th>
          </tr>
        </thead>
        <tbody>
          <% function formatThaiDate(dateStr) {
              const months = [
                "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน",
                "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
              ];
              const d = new Date(dateStr);
              if (isNaN(d)) return dateStr;
              return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
            }
          %>
          <% activities.forEach(activity => { %>
            <tr>
              <td>
                <span class="fw-semibold"><%= formatThaiDate(activity.date_act) %></span>
                <div class="text-muted small">
                  <i class="bi bi-clock me-1"></i> <%= activity.act_time %> น.
                </div>
              </td>
              <td class="fw-bold text-primary">
                <%= activity.activity %>
                <% if (new Date().toDateString() === new Date(activity.date_act).toDateString()) { %>
                  <span class="badge bg-danger ms-2">วันนี้</span>
                <% } %>
              </td>
              <td>
                <i class="bi bi-geo-alt text-danger me-1"></i>
                <%= activity.place %>
              </td>
              <td class="text-center text-nowrap">
                <a href="/activities/view/<%= activity.act_id %>" class="btn btn-info btn-sm me-1">
                  <i class="bi bi-eye"></i> view
                </a>
                <% if(user && (user.mClass==='pbt' || user.mClass==='admin')) { %>
                  <a href="/activities/edit/<%= activity.act_id %>" class="btn btn-warning btn-sm me-1">
                    <i class="bi bi-pencil-square"></i> แก้ไข
                  </a>
                  <a href="/activities/delete/<%= activity.act_id %>" class="btn btn-danger btn-sm"
                     onclick="return confirm('ยืนยันการลบ?')">
                    <i class="bi bi-trash"></i> ลบ
                  </a>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<%- include('../partials/footer.ejs') %>

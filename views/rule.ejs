<%- include('partials/header') %>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
  <h3 class="mb-4">üìã ‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå/‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</h3>
  <% if(user && user.mClass=='admin'){ %> 
    <a href="/rule/upload" class="btn btn-success mb-3">
      <i class="bi bi-plus-circle"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö
    </a>
    <% } %>
</div>
  <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input type="text" id="searchInput" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô" value="<%= search %>">
        <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">‡∏•‡πâ‡∏≤‡∏á</button>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th scope="col">‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô</th>
          <th scope="col"> ‡∏û.‡∏®.</th>
          <th scope="col">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th>
        </tr>
      </thead>
      <tbody id="ruleTable">
        <% alls.forEach(list => { %>
        <tr>
          <td><%= list.rule_name %></td>
          <td><%= list.rule_year %></td>
          <td>
            <a href="/rule/<%= list.rule_id %>" class="btn btn-sm btn-outline-primary" target="_blank">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav>
    <ul class="pagination justify-content-center">
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
          <a class="page-link" href="/rule?page=<%= i %><%= search ? '&search=' + search : '' %>"><%= i %></a>
        </li>
      <% } %>
    </ul>
  </nav>
</div>

<script>
  const searchInput = document.getElementById('searchInput');
  const ruleTable = document.getElementById('ruleTable');
  let searchTimeout;

  searchInput.addEventListener('keyup', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const keyword = searchInput.value.toLowerCase();
      const rows = ruleTable.querySelectorAll('tr');

      rows.forEach(row => {
        const ruleName = row.children[0].innerText.toLowerCase();
        row.style.display = ruleName.includes(keyword) ? '' : 'none';
      });
    }, 300); // ‡∏£‡∏≠ 300ms
  });

  function clearSearch() {
    searchInput.value = '';
    const rows = ruleTable.querySelectorAll('tr');
    rows.forEach(row => {
      row.style.display = '';
    });
  }
</script>

<%- include('partials/footer') %>
